<?xml version="1.0" encoding="UTF-8"?>
<install4j version="5.0.9" transformSequenceNumber="3">
  <directoryPresets config="./images" />
  <application name="${compiler:name.full}" distributionSourceDir="${compiler:src.dir}" applicationId="3069-1244-9928-3021" mediaDir="target" mediaFilePattern="${compiler:dist.name}-${compiler:app.version}" compression="6" lzmaCompression="false" pack200Compression="false" excludeSignedFromPacking="true" commonExternalFiles="false" createMd5Sums="true" shrinkRuntime="true" shortName="${compiler:name.short}" publisher="Atlassian" publisherWeb="http://www.atlassian.com/" version="${compiler:app.version}" allPathsRelative="true" backupOnSave="false" autoSave="true" convertDotsToUnderscores="false" macSignature="????" installerName="" javaMinVersion="1.6" javaMaxVersion="" allowBetaVM="false" jdkMode="runtimeJre" jdkName="">
    <languages skipLanguageSelection="true" languageSelectionInPrincipalLanguage="false">
      <principalLanguage id="en" customLocalizationFile="./messages/messages_en.utf8" />
      <additionalLanguages />
    </languages>
    <searchSequence>
      <registry />
      <envVar name="JAVA_HOME" />
      <envVar name="JDK_HOME" />
    </searchSequence>
    <variables>
      <variable name="app.rmiPort" value="8005" description="Default tomcat control port" category="" />
      <variable name="app.version" value="3.10.1" description="" category="" />
      <variable name="app.httpPort" value="8080" description="Default tomcat http request port" category="" />
      <variable name="app.startup.timeout" value="60" description="Time to wait until app has started" category="" />
      <variable name="app.launch.error" value="false" description="" category="" />
      <variable name="app.startup.polling.interval" value="3" description="" category="" />
      <variable name="keystore.home" value="" description="" category="" />
      <variable name="install4j.home" value="" description="" category="" />
      <variable name="keystore.password" value="" description="" category="" />
      <variable name="install.execution.mode" value="gui" description="" category="" />
      <variable name="docs.version" value="041" description="" category="" />
      <variable name="windows.installer.64bit" value="false" description="Flag that is only set for windows 64bit installer" category="" />
      <variable name="platform.minimum.upgradable.version" value="5.0" description="" category="" />
      <variable name="jira.version" value="" description="" category="" />
      <variable name="timestamp.server" value="http://timestamp.digicert.com" description="" category="" />
    </variables>
    <mergedProjects />
  </application>
  <files keepModificationTimes="false" missingFilesStrategy="error" globalExcludeSuffixes="" defaultOverwriteMode="4" defaultUninstallMode="0" launcherOverwriteMode="3" defaultFileMode="644" defaultDirMode="755">
    <filesets />
    <roots />
    <mountPoints>
      <mountPoint id="67291" root="" location="bin" mode="755" />
      <mountPoint id="17" root="" location="" mode="755" />
    </mountPoints>
    <entries>
      <fileEntry mountPoint="67291" file="./bin/setup_user.sh" overwriteMode="4" shared="false" fileMode="755" uninstallMode="0" overrideFileMode="true" overrideOverwriteMode="false" overrideUninstallMode="false" />
      <fileEntry mountPoint="67291" file="./bin/install_linux_service.sh" overwriteMode="4" shared="false" fileMode="755" uninstallMode="0" overrideFileMode="true" overrideOverwriteMode="false" overrideUninstallMode="false" />
      <fileEntry mountPoint="17" file="./bin/shutdown_bundled_jre.bat" overwriteMode="0" shared="false" fileMode="644" uninstallMode="0" overrideFileMode="true" overrideOverwriteMode="true" overrideUninstallMode="true" />
      <dirEntry mountPoint="17" file="STANDALONE_TARGET_PATH" overwriteMode="0" shared="false" fileMode="644" uninstallMode="0" overrideFileMode="true" overrideOverwriteMode="true" overrideUninstallMode="true" entryMode="direct" subDirectory="" excludeSuffixes="" dirMode="755" overrideDirMode="true">
        <exclude />
      </dirEntry>
      <fileEntry mountPoint="17" file="./images/JIRAplay.ico" overwriteMode="0" shared="false" fileMode="644" uninstallMode="0" overrideFileMode="true" overrideOverwriteMode="true" overrideUninstallMode="true" />
      <fileEntry mountPoint="17" file="./images/JIRAstop.ico" overwriteMode="0" shared="false" fileMode="644" uninstallMode="0" overrideFileMode="true" overrideOverwriteMode="true" overrideUninstallMode="true" />
      <fileEntry mountPoint="17" file="./images/JIRA.ico" overwriteMode="0" shared="false" fileMode="644" uninstallMode="0" overrideFileMode="true" overrideOverwriteMode="true" overrideUninstallMode="true" />
      <fileEntry mountPoint="17" file="./bin/control_service.bat" overwriteMode="0" shared="false" fileMode="644" uninstallMode="0" overrideFileMode="true" overrideOverwriteMode="true" overrideUninstallMode="true" />
      <fileEntry mountPoint="17" file="./bin/stop_service.bat" overwriteMode="0" shared="false" fileMode="644" uninstallMode="0" overrideFileMode="true" overrideOverwriteMode="true" overrideUninstallMode="true" />
      <fileEntry mountPoint="17" file="./bin/start_service.bat" overwriteMode="0" shared="false" fileMode="644" uninstallMode="0" overrideFileMode="true" overrideOverwriteMode="true" overrideUninstallMode="true" />
      <fileEntry mountPoint="17" file="./bin/startup_bundled_jre.bat" overwriteMode="0" shared="false" fileMode="644" uninstallMode="0" overrideFileMode="true" overrideOverwriteMode="true" overrideUninstallMode="true" />
      <fileEntry mountPoint="17" file="./Launch JIRA in browser.url" overwriteMode="0" shared="false" fileMode="644" uninstallMode="0" overrideFileMode="true" overrideOverwriteMode="true" overrideUninstallMode="true" />
    </entries>
    <components />
  </files>
  <launchers />
  <installerGui installerType="1" addOnAppId="" suggestPreviousLocations="true" autoUpdateDescriptorUrl="" useAutoUpdateBaseUrl="false" autoUpdateBaseUrl="">
    <customCode>
      <archive location="./artifacts/commons-codec.jar" />
      <archive location="./artifacts/commons-httpclient.jar" />
      <archive location="./artifacts/commons-io.jar" />
      <archive location="./artifacts/dom4j.jar" />
      <archive location="./artifacts/inception.jar" />
      <archive location="./artifacts/modzdetector.jar" />
      <archive location="./artifacts/slf4j-api.jar" />
      <archive location="./artifacts/slf4j-jdk14.jar" />
    </customCode>
    <autoUpdate useMinUpdatableVersion="false" minUpdatableVersion="" useMaxUpdatableVersion="false" maxUpdatableVersion="">
      <commentFiles />
      <customAttributes />
    </autoUpdate>
    <applications>
      <application name="" id="installer" customizedId="" beanClass="com.install4j.runtime.beans.applications.InstallerApplication" enabled="true" commentSet="false" comment="" fileset="" customIcnsFile="" customIcoFile="./images/JIRA.ico" automaticLauncherIntegration="false" launchMode="startupFirstWindow" launchInNewProcess="false" launchSchedule="updateSchedule" allLaunchers="true">
        <serializedBean>
          <java class="java.beans.XMLDecoder">
            <object class="com.install4j.runtime.beans.applications.InstallerApplication">
              <void property="consoleScreenChangeHandler">
                <object class="com.install4j.api.beans.ScriptProperty">
                  <void property="value">
                    <string>console.println();</string>
                  </void>
                </object>
              </void>
              <void property="customHeaderImage">
                <object class="com.install4j.api.beans.ExternalFile">
                  <string>./images/jira_logo_fade_narrow.png</string>
                </object>
              </void>
              <void property="customIconImageFiles">
                <void method="add">
                  <object class="com.install4j.api.beans.ExternalFile">
                    <string>./images/Jira_16.png</string>
                  </object>
                </void>
                <void method="add">
                  <object class="com.install4j.api.beans.ExternalFile">
                    <string>./images/Jira_32.png</string>
                  </object>
                </void>
              </void>
              <void property="frameSizeClientArea">
                <boolean>false</boolean>
              </void>
              <void property="useCustomIcon">
                <boolean>true</boolean>
              </void>
              <void property="vmParameters">
                <string>-Dinstall4j.executionMode=${compiler:install.execution.mode} </string>
              </void>
              <void property="watermark">
                <boolean>false</boolean>
              </void>
            </object>
          </java>
        </serializedBean>
        <launcherIds />
        <variables />
        <startup>
          <screen name="" id="15" customizedId="" beanClass="com.install4j.runtime.beans.screens.StartupScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="2" finishScreen="false" wizardIndexChangeType="unchanged" wizardIndexKey="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.screens.StartupScreen" />
              </java>
            </serializedBean>
            <condition />
            <validation />
            <preActivation />
            <postActivation />
            <actions>
              <group name="Ask For Privileges" id="66516" customizedId="" beanClass="com.install4j.runtime.beans.groups.ActionGroup" enabled="true" commentSet="false" comment="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.groups.ActionGroup">
                      <void property="conditionExpression">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>return !context.isUnattended(); // don't ask for priviligies in unattended mode</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <beans>
                  <action name="Disable java.logging" id="68691" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                          <void property="script">
                            <object class="com.install4j.api.beans.ScriptProperty">
                              <void property="value">
                                <string>import java.util.logging.Handler;
import java.util.logging.Level;
import java.util.logging.Logger;

Handler[] handlers = Logger.getLogger("").getHandlers();
for (Handler handler : handlers)
{
    handler.setLevel(Level.OFF);
}

return true;</string>
                              </void>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                  <action name="" id="65936" customizedId="" beanClass="com.install4j.runtime.beans.actions.misc.RequestPrivilegesAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.misc.RequestPrivilegesAction">
                          <void property="failIfNotObtainedWin">
                            <boolean>false</boolean>
                          </void>
                          <void property="obtainIfNormalWin">
                            <boolean>true</boolean>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                  <action name="" id="59774" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="Admin warning" rollbackBarrier="false" multiExec="false" failureStrategy="2" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                          <void property="script">
                            <object class="com.install4j.api.beans.ScriptProperty">
                              <void property="value">
                                <string>if(Util.hasFullAdminRights())
{
    return true;
}
else
{
    int selection = Util.showOptionDialog(context.getMessage("error.no.admin.rights"), new String[] {context.getMessage("message.button.yes"), context.getMessage("message.button.no")}, javax.swing.JOptionPane.WARNING_MESSAGE);
    if(selection==0)
    {
        context.setVariable("app.install.service", false); // not an admin, so won't install as a service
        return true;
    }

    return false;
}</string>
                              </void>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                </beans>
              </group>
            </actions>
            <formComponents />
          </screen>
        </startup>
        <screens>
          <screen name="" id="1" customizedId="" beanClass="com.install4j.runtime.beans.screens.WelcomeScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="2" finishScreen="false" wizardIndexChangeType="unchanged" wizardIndexKey="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.screens.WelcomeScreen">
                  <void property="bannerBackground">
                    <object class="java.awt.Color">
                      <int>0</int>
                      <int>51</int>
                      <int>102</int>
                      <int>255</int>
                    </object>
                  </void>
                  <void property="bannerImageFile">
                    <object class="com.install4j.api.beans.ExternalFile">
                      <string>./images/jira_logo_large.png</string>
                    </object>
                  </void>
                  <void property="updateCheck">
                    <boolean>false</boolean>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
            <validation />
            <preActivation />
            <postActivation />
            <actions />
            <formComponents />
          </screen>
          <screen name="" id="66884" customizedId="" beanClass="com.install4j.runtime.beans.screens.FormScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="2" finishScreen="false" wizardIndexChangeType="unchanged" wizardIndexKey="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.screens.FormScreen">
                  <void property="subTitle">
                    <string>${i18n:upgrade.notice.subtitle}</string>
                  </void>
                  <void property="title">
                    <string>${i18n:upgrade.notice("${compiler:sys.shortName}")}</string>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
            <validation>import com.atlassian.inception.UpgradeHelper;
import com.atlassian.inception.JiraUpgradeHelper;
import com.atlassian.inception.VersionStringComparator;
import com.atlassian.inception.JiraDbConfigMigrator;


 // Huge try-catch block just to catch any unforseen exceptions (so we show error to users instead of dieing silently)
try
{
    boolean isUpdateInstallation = new Boolean((String)context.getVariable("sys.confirmedUpdateInstallationString"));
    context.setVariable("sys.confirmedUpdateInstallation", isUpdateInstallation);

    if (isUpdateInstallation)
    {        
        String installDir = (String) context.getVariable("existingInstallationDir");
        
        // Check if the installDir actually exists or not
        if (!new File(installDir).exists())
        {
           Util.showErrorMessage(context.getMessage("error.directory.notfound"));
           if (context.isConsole())
           {
                context.finish(0);
           }
           return false;    
        }
        
        // Check the current user has enough permissions to continue with the upgrade
        try
        {
            new File(installDir + "/testsufficientjirauserpermission.txt").createNewFile();
            
        }
        catch (Exception e)
        {
           Util.showErrorMessage(context.getMessage("error.insufficient.permissions", new Object[]{context.getCompilerVariable("sys.shortName")}));
           if (context.isConsole())
            {
                System.exit(0); // exit the upgrader if we are in console mode.
            }
            return false;    
        }
        
        // The user has enough permissions, delete the test file and continue!
        new File(installDir + "/testsufficientjirauserpermission.txt").delete();
        
            
        // set the installation directory to the previous installation dir (we use it when extracting files)
        context.setInstallationDirectory(new File(installDir));
        UpgradeHelper upgradeHelper = new JiraUpgradeHelper(installDir);
        
        // First check the installationDir provided is valid
        if (upgradeHelper.isPotentialInstallationDir())
        {
            // Now check if we can find a jira-application.properties with jira.home defined
            if (!upgradeHelper.isHomeDirDefined())
            {
                Util.showErrorMessage(context.getMessage("error.unable.to.locate.home"));
                if (context.isConsole())
                {
                    context.finish(0); // exit the upgrader if we are in console mode
                }
                return false;
            }               
        
            // Now check the versions... we only allow upgrade, no downgrading.
            VersionStringComparator versionComparator = new VersionStringComparator();    
            String currPlatformVersion = (String) upgradeHelper.getExistingInstallationVersion();
            String newPlatformVersion = (String) context.getCompilerVariable("jira.version");

            String newInstallationVersion =  (String) context.getVariable("sys.version");
            int versionComparison = versionComparator.compare(currPlatformVersion, newPlatformVersion);
               
            if (versionComparison&lt;=0) 
            {
                String platformMinimalVersion = (String)context.getCompilerVariable("platform.minimum.upgradable.version");
                // Exit if upgrading from ancient version
                if (versionComparator.compare(currPlatformVersion, platformMinimalVersion) &lt; 0)
                {
                    Util.showErrorMessage(context.getMessage("error.cannot.upgrade", new Object[]{context.getCompilerVariable("sys.shortName"), currPlatformVersion, platformMinimalVersion}));
                    if (context.isConsole())
                    {
                        Util.showErrorMessage(context.getMessage("error.cannot.upgrade.docs",  new Object[]{context.getCompilerVariable("docs.version")}));
                        context.finish(0); // exit the upgrader if we are in console mode
                    }
                    return false;
                }
                // suport of jira earlier than 5 dropped
            }  
            else
            {
                Util.showErrorMessage(context.getMessage("error.cannot.downgrade", new Object[]{context.getCompilerVariable("sys.shortName")}));
                if (context.isConsole())
                {
                    context.finish(0); // exit the upgrader if we are in console mode
                }
                return false;
            }
        }
        else
        {
            Util.showErrorMessage(context.getMessage("error.invalid.installation.upgrade.dir", new Object[]{context.getCompilerVariable("sys.shortName")}));
            if (context.isConsole())
            {
                context.finish(0); // exit the upgrader if we are in console mode
            }
            return false;
        }                
    }
    
    return true;
}
catch (Exception e)
{
    Util.log(e);
    // An exception that we did not expect was thrown. Give feedback to the user
    Util.showErrorMessage(context.getMessage("error.unknown.upgrade.problem"));
    if (context.isConsole())
    {
        context.finish(0); // exit the upgrader if we are in console mode
    }
    return false;
}</validation>
            <preActivation>File installationDir = new File((String)context.getVariable("sys.installationDir"));
boolean isExpressInstall;

// If express.install isn't set, we want to default to 'true' (to encourage express installs)
if (context.getVariable("express.install") == null)
{
    isExpressInstall = true;
}
else
{
    isExpressInstall = context.getBooleanVariable("express.install");    
}

JRadioButton expressInstallButton = ((JRadioButton) formEnvironment.getFormComponentById("69790").getConfigurationObject());
JRadioButton normalInstallButton = ((JRadioButton) formEnvironment.getFormComponentById("66886").getConfigurationObject());
JRadioButton upgradeButton = ((JRadioButton) formEnvironment.getFormComponentById("66887").getConfigurationObject());

if (installationDir.exists())
{
    // select upgrade option
    upgradeButton.setSelected(true);
    expressInstallButton.setSelected(false);
    normalInstallButton.setSelected(false);
}
else if(isExpressInstall)
{
    // select express install option
    expressInstallButton.setSelected(true);        
    normalInstallButton.setSelected(false);
    upgradeButton.setSelected(false);
    // if we helped them select express, we should also set the variable
    context.setVariable("express.install", true); 
}
else
{
    // select normal install option
    normalInstallButton.setSelected(true);    
    expressInstallButton.setSelected(false);
    upgradeButton.setSelected(false);    
}

</preActivation>
            <postActivation />
            <actions>
              <action name="Register Response File Variables" id="70143" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>context.registerResponseFileVariable("app.install.service");
return true;</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="" id="68898" customizedId="" beanClass="com.install4j.runtime.beans.actions.misc.LoadResponseFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="true" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.misc.LoadResponseFileAction">
                      <void property="excludedVariables">
                        <array class="java.lang.String" length="1">
                          <void index="0">
                            <string>existingInstallationDir</string>
                          </void>
                        </array>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>context.getBooleanVariable("sys.confirmedUpdateInstallation")</condition>
              </action>
              <action name="" id="68901" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.SetVariableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="3" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.SetVariableAction">
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>
String productNameWithoutSpaces = context.getCompilerVariable("sys.shortName").replaceAll( "\\s", "");
if (Util.hasFullAdminRights())
{
    if (Util.isWindows())
    {
        return context.getVariable("sys.programFilesDir") + File.separator + "Atlassian" + File.separator
        + productNameWithoutSpaces;
    }
    else if (Util.isMacOS())
    {
        return File.separator + "Applications" + File.separator + "Atlassian" + File.separator
        + productNameWithoutSpaces;
    }
    else if (new File("/opt").exists())
    {
        return File.separator + "opt" + File.separator + "atlassian" + File.separator
        + context.getCompilerVariable("sys.shortName").replaceAll("\\s", "-").toLowerCase();
    }
    else
    {
        return "";
    }
} else
{
    String userHome = (String)context.getVariable("sys.userHome");
    if (Util.isWindows() || Util.isMacOS())
    {
        return userHome + File.separator + "Atlassian" + File.separator
        + productNameWithoutSpaces;
    } else
    {
        return userHome + File.separator + "atlassian" + File.separator
        + context.getCompilerVariable("sys.shortName").replaceAll("\\s", "-").toLowerCase();
    }
}</string>
                          </void>
                        </object>
                      </void>
                      <void property="variableName">
                        <string>sys.installationDir</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>return !context.isUnattended();</condition>
              </action>
              <action name="" id="68902" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.SetVariableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="3" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.SetVariableAction">
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>

                                String productNameWithoutSpaces = context.getCompilerVariable("sys.shortName").replaceAll( "\\s", "");
if (Util.hasFullAdminRights())
{
    if (Util.isWindows())
    {
        return context.getVariable("sys.programFilesDir") + File.separator + "Atlassian" + File.separator + "Application Data" +
        File.separator + productNameWithoutSpaces;
    }
    else if (Util.isMacOS())
    {
        if (new File("/Library/Application Support/").exists())
        {
            return File.separator + "Library" + File.separator + "Application Support" + File.separator
            + "Atlassian" + File.separator + "Application Data" + File.separator + productNameWithoutSpaces;
        }
    }
    else
    {
        if (new File("/var").exists())
        {
            return File.separator + "var" + File.separator + "atlassian" + File.separator + "application-data" + File.separator
            + context.getCompilerVariable("sys.shortName").replaceAll("\\s", "-").toLowerCase();
        }
    }
    
    return "";
} 
else
{
    String userHome = (String)context.getVariable("sys.userHome");
    if (Util.isWindows() || Util.isMacOS())
    {
        return userHome + File.separator + "Atlassian" + File.separator + "Application Data" + File.separator
        + productNameWithoutSpaces;
    } else
    {
        return userHome + File.separator + "atlassian" + File.separator + "application-data" + File.separator
        + context.getCompilerVariable("sys.shortName").replaceAll("\\s", "-").toLowerCase();
    }
}</string>
                          </void>
                        </object>
                      </void>
                      <void property="variableName">
                        <string>app.defaultJiraHome</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="Set installation parameters for upgrade" id="67001" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="4" errorMessage="Problems reading the installation directory.">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>import com.atlassian.inception.UpgradeHelper;
import com.atlassian.inception.JiraUpgradeHelper;
import com.atlassian.inception.InstallerUtils;

final String installDir = (String) context.getVariable("existingInstallationDir");
String homeDir = null;

// set the installation directory to the previous installation dir (we use it when extracting files)
context.setInstallationDirectory(new File(installDir));
try
{
    UpgradeHelper helper = new JiraUpgradeHelper(installDir);
    homeDir = helper.getHomeDir().getPath();

    context.setVariable("app.jiraHome", homeDir);
    context.setVariable("app.backup.jiraHome", homeDir + "-" + helper.getExistingInstallationVersion() + "-back.zip");        
    context.setVariable("backup.installationDir", installDir + "-" + helper.getExistingInstallationVersion() + "-back.zip");
    Long httpPort = helper.getHttpPort();
    if (httpPort == null)
    {
        httpPort = Long.parseLong(context.getCompilerVariable("app.httpPort"));
    }
    context.setVariable("httpPort", httpPort);
    context.setVariable("rmiPort", helper.getRmiPort());
    context.setVariable("installationID", helper.getInstallationId());
    context.setVariable("app.install.service", helper.isInstalledAsService((String)context.getVariable("sys.programGroupName")));
 
    context.setVariable("startup.parameters", helper.getStartupParameters());
}
catch (Throwable t)
{
    Util.log(t);
    return false;
}

if (InstallerUtils.isSubDir(installDir, homeDir))
{
    Util.showErrorMessage(context.getMessage("error.home.dir.under.install.dir.cannot.upgrade"));
    context.finish(0);
}
return true;</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>return context.getBooleanVariable("sys.confirmedUpdateInstallation");</condition>
              </action>
              <action name="Read in jira-applications.properties" id="67879" customizedId="" beanClass="com.install4j.runtime.beans.actions.text.ReadTextFromFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.ReadTextFromFileAction">
                      <void property="file">
                        <object class="java.io.File">
                          <string>${installer:existingInstallationDir}/atlassian-jira/WEB-INF/classes/jira-application.properties</string>
                        </object>
                      </void>
                      <void property="variableName">
                        <string>jiraprops</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>return context.getBooleanVariable("sys.confirmedUpdateInstallation");</condition>
              </action>
              <action name="Set defaults for Express Install" id="69783" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="true" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>import com.atlassian.inception.JiraValidator;
import com.atlassian.inception.PortChecker;

// ------------------------------------------
// Set any defaults if required
// ------------------------------------------

// Install Directory (Default already set)
// Retrieve with: context.getInstallationDirectory();

// Home Directory
if (context.getVariable("app.jiraHome") == null)
{
    String defaultHomeDir = (String) context.getVariable("app.defaultJiraHome"); // default home is set in the previous actions
    context.setVariable("app.jiraHome", defaultHomeDir); // we use 'app.jiraHome' in the Install actions
}

// Start Menu Item (Windows only)
String defaultStartMenuEntry = (String)context.getVariable("sys.programsDir") + "\\" + (String) context.getCompilerVariable("sys.shortName");

// Set port numbers from defaults if they are not already set (eg. they can be set via response file)
// Retrieve with: context.getCompilerVariable("app.httpPort"), context.getCompilerVariable("app.rmiPort")
if (context.getVariable("httpPort") == null)
{
    context.setVariable("httpPort", Long.parseLong(context.getCompilerVariable("app.httpPort"))); // we use httpPort, rmiPort in Install actions
}
if (context.getVariable("rmiPort") == null)
{
    context.setVariable("rmiPort", Long.parseLong(context.getCompilerVariable("app.rmiPort")));
}

// Install as Service
// Set to true iff has full admin rights
if (context.getVariable("app.install.service") == null)
{
    context.setVariable("app.install.service", Util.hasFullAdminRights());
}

// ------------------------------------------
// Check for conflicts
// ------------------------------------------

File defaultInstallationDir = context.getInstallationDirectory();
JiraValidator validator = new JiraValidator(defaultInstallationDir);
String conflicts = "";

// Installation directory
if (validator.isExistingInstallationDirectory())
{
    context.setVariable("express.installdir.conflict", true);
    conflicts = context.getMessage("express.installdir.conflict");
}

// Home directory
if (validator.isExistingHomeDirectory((String)context.getVariable("app.jiraHome")))
{
    context.setVariable("express.homedir.notempty", true);
    conflicts += context.getMessage("express.homedir.notempty");
}

// Start menu item
if (Util.isWindows() &amp;&amp;  new File(defaultStartMenuEntry).exists())
{
    context.setVariable("express.programgroup.conflict", true);
    conflicts += context.getMessage("express.programgroup.conflict");
}

// Ports
int httpPort = Integer.valueOf(context.getCompilerVariable("app.httpPort")).intValue();
int rmiPort = Integer.valueOf(context.getCompilerVariable("app.rmiPort")).intValue();

PortChecker httpPortValidator = new PortChecker(httpPort);
PortChecker rmiPortValidator = new PortChecker(rmiPort);
java.net.InetAddress local = java.net.InetAddress.getByAddress(new byte[]{127,0,0,1});

// Check if we can connect to the ports
if (!httpPortValidator.canConnect(null))
{
    context.setVariable("express.port.conflict", true);
    conflicts += context.getMessage("express.httpport.conflict");
}

if (!(rmiPortValidator.canConnect(null) &amp;&amp; rmiPortValidator.canConnect(local)))
{
    context.setVariable("express.port.conflict", true);
    conflicts += context.getMessage("express.rmiport.conflict");
}

// Show warning popup if we detected any conflicts
if (!conflicts.isEmpty())
{
    Util.showWarningMessage(context.getMessage("express.conflict.warning") + conflicts);
}

return true;</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>context.getBooleanVariable("express.install")</condition>
              </action>
            </actions>
            <formComponents>
              <formComponent name="" id="66885" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.MultilineLabelComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.formcomponents.MultilineLabelComponent">
                      <void property="labelText">
                        <string>${i18n:install.upgrade.selection.notice}</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <initScript />
                <visibilityScript />
              </formComponent>
              <formComponent name="expressInstall" id="69790" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.SingleRadiobuttonComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.formcomponents.SingleRadiobuttonComponent">
                      <void property="radioButtonLabel">
                        <string>${i18n:express.install.label}</string>
                      </void>
                      <void property="selectionScript">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>context.setVariable("express.install", true);
formEnvironment.getLayoutGroupById("67120").setVisible(false);</string>
                          </void>
                        </object>
                      </void>
                      <void property="variableName">
                        <string>sys.confirmedUpdateInstallationString</string>
                      </void>
                      <void property="variableValue">
                        <string>false</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <initScript />
                <visibilityScript />
              </formComponent>
              <formComponent name="newInstallChoice" id="66886" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.SingleRadiobuttonComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.formcomponents.SingleRadiobuttonComponent">
                      <void property="radioButtonLabel">
                        <string>${i18n:new.install.label}</string>
                      </void>
                      <void property="selectionScript">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>context.setVariable("express.install", false);
formEnvironment.getLayoutGroupById("67120").setVisible(false);</string>
                          </void>
                        </object>
                      </void>
                      <void property="variableName">
                        <string>sys.confirmedUpdateInstallationString</string>
                      </void>
                      <void property="variableValue">
                        <string>false</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <initScript />
                <visibilityScript />
              </formComponent>
              <formComponent name="" id="69791" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.SeparatorComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.formcomponents.SeparatorComponent" />
                  </java>
                </serializedBean>
                <initScript />
                <visibilityScript />
              </formComponent>
              <formComponent name="upgradeInstallChoice" id="66887" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.SingleRadiobuttonComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.formcomponents.SingleRadiobuttonComponent">
                      <void property="radioButtonLabel">
                        <string>${i18n:upgrade.existing.install.label("${compiler:sys.shortName}")}</string>
                      </void>
                      <void property="selectionScript">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>context.setVariable("express.install", false);
formEnvironment.getLayoutGroupById("67120").setVisible(true);</string>
                          </void>
                        </object>
                      </void>
                      <void property="variableName">
                        <string>sys.confirmedUpdateInstallationString</string>
                      </void>
                      <void property="variableValue">
                        <string>true</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <initScript />
                <visibilityScript />
              </formComponent>
              <group name="" id="67120" customizedId="" beanClass="com.install4j.runtime.beans.groups.VerticalFormComponentGroup" enabled="true" commentSet="false" comment="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.groups.VerticalFormComponentGroup">
                      <void property="insets">
                        <object class="java.awt.Insets">
                          <int>0</int>
                          <int>25</int>
                          <int>0</int>
                          <int>0</int>
                        </object>
                      </void>
                      <void property="visibilityScript">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>File installationDir = new File((String)context.getVariable("sys.installationDir"));

return installationDir.exists() &amp;&amp; !context.getBooleanVariable("express.install");</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <beans>
                  <formComponent name="Choose install dir" id="66888" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.DirectoryChooserComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="5" insetBottom="" insetRight="" resetInitOnPrevious="false">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.formcomponents.DirectoryChooserComponent">
                          <void property="initialFile">
                            <string>${installer:sys.installationDir}</string>
                          </void>
                          <void property="labelText">
                            <string>${i18n:select.existing.install.dir.label}</string>
                          </void>
                          <void property="validationScript">
                            <object class="com.install4j.api.beans.ScriptProperty">
                              <void property="value">
                                <string />
                              </void>
                            </object>
                          </void>
                          <void property="variableName">
                            <string>existingInstallationDir</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <initScript />
                    <visibilityScript />
                  </formComponent>
                  <formComponent name="Backup jira file option" id="67118" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.CheckboxComponent" enabled="false" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.formcomponents.CheckboxComponent">
                          <void property="checkboxText">
                            <string>${i18n:upgrade.backup.option1("${compiler:sys.shortName}")}</string>
                          </void>
                          <void property="initiallySelected">
                            <boolean>true</boolean>
                          </void>
                          <void property="variableName">
                            <string>backupJira</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <initScript />
                    <visibilityScript />
                  </formComponent>
                </beans>
              </group>
            </formComponents>
          </screen>
          <group name="Installation Questions" id="66889" customizedId="" beanClass="com.install4j.runtime.beans.groups.ScreenGroup" enabled="true" commentSet="false" comment="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.groups.ScreenGroup">
                  <void property="conditionExpression">
                    <object class="com.install4j.api.beans.ScriptProperty">
                      <void property="value">
                        <string>return !context.getBooleanVariable("sys.confirmedUpdateInstallation");</string>
                      </void>
                    </object>
                  </void>
                </object>
              </java>
            </serializedBean>
            <beans>
              <screen name="" id="59882" customizedId="" beanClass="com.install4j.runtime.beans.screens.InstallationDirectoryScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="1" finishScreen="false" wizardIndexChangeType="unchanged" wizardIndexKey="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.screens.InstallationDirectoryScreen">
                      <void property="existingDirWarning">
                        <boolean>false</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>return !context.getBooleanVariable("express.install") || context.getBooleanVariable("express.installdir.conflict");</condition>
                <validation>import com.atlassian.inception.JiraValidator;

File installationDir = context.getInstallationDirectory();

JiraValidator validator = new JiraValidator(installationDir);
if (validator.isExistingInstallationDirectory())
{
     Util.showErrorMessage(context.getMessage("error.invalid.installation.dir", new Object[]{context.getCompilerVariable("sys.shortName")}));
     return false;
}

if (validator.isInstallationDirPathTooLong())
{
    Util.showErrorMessage(context.getMessage("error.path.too.long"));
    return false;    
}

return true;</validation>
                <preActivation />
                <postActivation />
                <actions />
                <formComponents />
              </screen>
              <screen name="JIRA Home location" id="65652" customizedId="" beanClass="com.install4j.runtime.beans.screens.CustomizableDirectoryScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="2" finishScreen="false" wizardIndexChangeType="unchanged" wizardIndexKey="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.screens.CustomizableDirectoryScreen">
                      <void property="infoText">
                        <string>${i18n:configure.installation.home.directory.info.text}</string>
                      </void>
                      <void property="initialDirectory">
                        <string>${installer:app.defaultJiraHome}</string>
                      </void>
                      <void property="onlyWritable">
                        <boolean>true</boolean>
                      </void>
                      <void property="subTitle">
                        <string>${i18n:configure.installation.home.directory.screen.subtitle("${compiler:sys.shortName}")}</string>
                      </void>
                      <void property="title">
                        <string>${i18n:configure.installation.home.directory.screen.title("${compiler:sys.shortName}")}</string>
                      </void>
                      <void property="variableName">
                        <string>app.jiraHome</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>import com.atlassian.inception.InstallerUtils;

// If jira.home is a subdir of the installation directory, show this screen (even if it is express)
if (InstallerUtils.isSubDir(context.getInstallationDirectory().getAbsolutePath(), (String) context.getVariable("app.defaultJiraHome")))
{
    return true;
}

// Show if it is a normal install, or if during express install we've detected a nonempty jira.home
return !context.getBooleanVariable("express.install") ||  context.getBooleanVariable("express.homedir.notempty");</condition>
                <validation>import com.atlassian.inception.InstallerUtils;

// Check the chosen jira.home is not a subdir of the installation directory
if (InstallerUtils.isSubDir(context.getInstallationDirectory().getAbsolutePath(), (String)context.getVariable("app.jiraHome")))
{
        Util.showErrorMessage(context.getMessage("error.home.dir.under.install.dir"));
        return false;
}
return true;</validation>
                <preActivation />
                <postActivation />
                <actions />
                <formComponents />
              </screen>
              <screen name="" id="60115" customizedId="" beanClass="com.install4j.runtime.beans.screens.StandardProgramGroupScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="2" finishScreen="false" wizardIndexChangeType="unchanged" wizardIndexKey="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.screens.StandardProgramGroupScreen">
                      <void property="allUsers">
                        <boolean>false</boolean>
                      </void>
                      <void property="allowUserChangeEnabled">
                        <boolean>false</boolean>
                      </void>
                      <void property="programGroupName">
                        <string>${compiler:sys.shortName}</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>return (Util.isWindows() &amp;&amp; !context.getBooleanVariable("sys.confirmedUpdateInstallation") &amp;&amp; (!context.getBooleanVariable("express.install") || context.getBooleanVariable("express.programgroup.conflict")));</condition>
                <validation>if (new File((String)context.getVariable("sys.programGroupDir")).exists()) {
    Util.showErrorMessage(context.getMessage("error.invalid.program.group"));
    return false;
}

return true;</validation>
                <preActivation />
                <postActivation />
                <actions />
                <formComponents />
              </screen>
              <screen name="Set Tomcat port" id="66053" customizedId="" beanClass="com.install4j.runtime.beans.screens.FormScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="2" finishScreen="false" wizardIndexChangeType="unchanged" wizardIndexKey="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.screens.FormScreen">
                      <void property="subTitle">
                        <string>${i18n:configure.installation.subtitle("${compiler:sys.shortName}")}</string>
                      </void>
                      <void property="title">
                        <string>${i18n:configure.installation}</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>// We want to always show this screen now INST-37 (unless it is an express install with no conflicts)
return !context.getBooleanVariable("express.install") || context.getBooleanVariable("express.port.conflict");</condition>
                <validation>import com.atlassian.inception.PortChecker;
//Are given ports available

// If default was chosen, set http/rmi port to default values, otherwise use
int httpPort;
int rmiPort;

if ("default".equals(context.getVariable("portChoice")))
{

    httpPort = Integer.valueOf(context.getCompilerVariable("app.httpPort")).intValue();
    rmiPort = Integer.valueOf(context.getCompilerVariable("app.rmiPort")).intValue();
}
else
{
    httpPort = (int) ((Long) context.getVariable("httpPort")).longValue();
    rmiPort = (int) ((Long) context.getVariable("rmiPort")).longValue();
}

if (rmiPort == httpPort)
{
    Util.showErrorMessage(context.getMessage("error.ports.same"));
    return false;
}

PortChecker httpPortValidator = new PortChecker(httpPort);
PortChecker rmiPortValidator = new PortChecker(rmiPort);
java.net.InetAddress local = java.net.InetAddress.getByAddress(new byte[]{127,0,0,1});

// Check port ranges
if (!httpPortValidator.isValidPortRange())
{
    Util.showErrorMessage(context.getMessage("error.invalid.http.port.range"));
    return false;
}

if (!rmiPortValidator.isValidPortRange())
{
    Util.showErrorMessage(context.getMessage("error.invalid.rmi.port.range"));
    return false;
}

// Check if we can connect to the ports
if (!httpPortValidator.canConnect(null))
{
    Util.showErrorMessage(context.getMessage("error.http.port.in.use"));
    return false;
}

if (!(rmiPortValidator.canConnect(null) &amp;&amp; rmiPortValidator.canConnect(local)))
{
    Util.showErrorMessage(context.getMessage("error.rmi.port.in.use"));
    return false;    
}
return true;</validation>
                <preActivation>boolean isLastQuestionScreen = !Util.hasFullAdminRights() &amp;&amp; !context.getBooleanVariable("express.install");
if (isLastQuestionScreen) {
    context.getWizardContext().setNextButtonText("Install");
}</preActivation>
                <postActivation />
                <actions />
                <formComponents>
                  <formComponent name="" id="66057" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.MultilineLabelComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.formcomponents.MultilineLabelComponent">
                          <void property="labelText">
                            <string>${i18n:configure.installation.description("${compiler:sys.shortName}")}</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <initScript />
                    <visibilityScript />
                  </formComponent>
                  <formComponent name="" id="66056" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.SeparatorComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.formcomponents.SeparatorComponent" />
                      </java>
                    </serializedBean>
                    <initScript />
                    <visibilityScript />
                  </formComponent>
                  <formComponent name="defaultPortChoice" id="66064" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.SingleRadiobuttonComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.formcomponents.SingleRadiobuttonComponent">
                          <void property="initiallySelected">
                            <boolean>true</boolean>
                          </void>
                          <void property="radioButtonLabel">
                            <string>${i18n:default.port.number}</string>
                          </void>
                          <void property="selectionScript">
                            <object class="com.install4j.api.beans.ScriptProperty">
                              <void property="value">
                                <string>context.setVariable("portChoice", "default");
formEnvironment.getFormComponentById("66054").setVisible(false); // Hide port field
formEnvironment.getFormComponentById("66055").setVisible(false); // Hide rmi port field</string>
                              </void>
                            </object>
                          </void>
                          <void property="variableName">
                            <string>portChoice</string>
                          </void>
                          <void property="variableValue">
                            <string>default</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <initScript />
                    <visibilityScript />
                  </formComponent>
                  <formComponent name="customPortChoice" id="66065" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.SingleRadiobuttonComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.formcomponents.SingleRadiobuttonComponent">
                          <void property="radioButtonLabel">
                            <string>${i18n:custom.port.number}</string>
                          </void>
                          <void property="selectionScript">
                            <object class="com.install4j.api.beans.ScriptProperty">
                              <void property="value">
                                <string>context.setVariable("portChoice", "custom");
formEnvironment.getFormComponentById("66054").setVisible(true); // Show port field
formEnvironment.getFormComponentById("66055").setVisible(true); // Show rmi port field</string>
                              </void>
                            </object>
                          </void>
                          <void property="variableName">
                            <string>portChoice</string>
                          </void>
                          <void property="variableValue">
                            <string>custom</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <initScript>if (context.getBooleanVariable("express.port.conflict"))
{
    configurationObject.setSelected(true);
    context.setVariable("portChoice", "custom");
    
    formEnvironment.getFormComponentById("66054").setVisible(true); // Show port field
    formEnvironment.getFormComponentById("66055").setVisible(true); // Show rmi port field
}</initScript>
                    <visibilityScript />
                  </formComponent>
                  <formComponent name="port number" id="66054" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.IntegerTextfieldComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.formcomponents.IntegerTextfieldComponent">
                          <void property="initialText">
                            <string>${compiler:app.httpPort}</string>
                          </void>
                          <void property="inputVerifier">
                            <object class="com.install4j.api.beans.ScriptProperty">
                              <void property="value">
                                <string>try
{
    int port = Integer.parseInt(text);
    if (Util.isLinux() &amp;&amp; port &lt; 1024)
    {
        Util.showErrorMessage(context.getMessage("error.port.number.too.low"));
        return false;
    }
    else
    {
        return true;
    }
}
catch (NumberFormatException e)
{
    return false;
}</string>
                              </void>
                            </object>
                          </void>
                          <void property="keyValidator">
                            <object class="com.install4j.api.beans.ScriptProperty">
                              <void property="value">
                                <string>"0123456789".indexOf(keyChar) != -1</string>
                              </void>
                            </object>
                          </void>
                          <void property="labelText">
                            <string>${i18n:http.port.number}</string>
                          </void>
                          <void property="maximumDigits">
                            <int>5</int>
                          </void>
                          <void property="minimumDigits">
                            <int>1</int>
                          </void>
                          <void property="variableName">
                            <string>httpPort</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <initScript />
                    <visibilityScript>// Hide when we first display this form
return "custom".equals(context.getVariable("portChoice"));</visibilityScript>
                  </formComponent>
                  <formComponent name="rmi port number" id="66055" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.IntegerTextfieldComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.formcomponents.IntegerTextfieldComponent">
                          <void property="initialText">
                            <string>${compiler:app.rmiPort}</string>
                          </void>
                          <void property="inputVerifier">
                            <object class="com.install4j.api.beans.ScriptProperty">
                              <void property="value">
                                <string>try
{
    int port = Integer.parseInt(text);
    if (Util.isLinux() &amp;&amp; port &lt; 1024)
    {
        Util.showErrorMessage(context.getMessage("error.port.number.too.low"));
        return false;
    }
    else
    {
        return true;
    }
}
catch (NumberFormatException e)
{
    return false;
}</string>
                              </void>
                            </object>
                          </void>
                          <void property="keyValidator">
                            <object class="com.install4j.api.beans.ScriptProperty">
                              <void property="value">
                                <string>"0123456789".indexOf(keyChar) != -1</string>
                              </void>
                            </object>
                          </void>
                          <void property="labelText">
                            <string>${i18n:rmi.port.number}</string>
                          </void>
                          <void property="maximumDigits">
                            <int>5</int>
                          </void>
                          <void property="minimumDigits">
                            <int>1</int>
                          </void>
                          <void property="variableName">
                            <string>rmiPort</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <initScript />
                    <visibilityScript>// Hide when we first display this form
return "custom".equals(context.getVariable("portChoice"));</visibilityScript>
                  </formComponent>
                </formComponents>
              </screen>
              <screen name="Install as service" id="54715" customizedId="" beanClass="com.install4j.runtime.beans.screens.FormScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="2" finishScreen="false" wizardIndexChangeType="unchanged" wizardIndexKey="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.screens.FormScreen">
                      <void property="subTitle">
                        <string>${i18n:configure.installation.service.subtitle(${compiler:sys.shortName})}</string>
                      </void>
                      <void property="title">
                        <string>${i18n:configure.installation.service}</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>return (Util.hasFullAdminRights() &amp;&amp; !context.getBooleanVariable("express.install"));</condition>
                <validation />
                <preActivation>context.getWizardContext().setNextButtonText("Install");</preActivation>
                <postActivation />
                <actions />
                <formComponents>
                  <formComponent name="" id="59919" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.MultilineLabelComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.formcomponents.MultilineLabelComponent">
                          <void property="labelText">
                            <string>${i18n:configure.installation.description.service("${compiler:sys.shortName}")}</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <initScript>if(!Util.isAdminUser())
{
    component.setVisible(false);
    component.setEnabled(false);
}</initScript>
                    <visibilityScript />
                  </formComponent>
                  <formComponent name="" id="59708" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.CheckboxComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="10" insetRight="" resetInitOnPrevious="false">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.formcomponents.CheckboxComponent">
                          <void property="checkboxText">
                            <string>${i18n:install.as.service("${compiler:sys.shortName}")}</string>
                          </void>
                          <void property="initiallySelected">
                            <boolean>true</boolean>
                          </void>
                          <void property="variableName">
                            <string>app.install.service</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <initScript />
                    <visibilityScript />
                  </formComponent>
                  <formComponent name="" id="66433" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.SeparatorComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.formcomponents.SeparatorComponent" />
                      </java>
                    </serializedBean>
                    <initScript />
                    <visibilityScript />
                  </formComponent>
                  <formComponent name="" id="66429" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.MultilineLabelComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.formcomponents.MultilineLabelComponent">
                          <void property="labelText">
                            <string>${i18n:configure.installation.description.service.note}</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <initScript>if(!Util.isAdminUser())
{
    component.setVisible(false);
    component.setEnabled(false);
}</initScript>
                    <visibilityScript>return Util.isWindows();</visibilityScript>
                  </formComponent>
                  <formComponent name="" id="60161" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.HyperlinkLabelComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.formcomponents.HyperlinkLabelComponent">
                          <void property="hyperlinkText">
                            <string>${i18n:configure.installation.service.link(${compiler:sys.shortName})}</string>
                          </void>
                          <void property="url">
                            <string>http://docs.atlassian.com/jira/docs-${compiler:docs.version}/Running+JIRA+Standalone+as+a+Service#RunningJIRAStandaloneasaService-ChangingtheWindowsuserthattheJIRAserviceuses</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <initScript />
                    <visibilityScript>return Util.isWindows();</visibilityScript>
                  </formComponent>
                </formComponents>
              </screen>
              <screen name="Summary" id="69784" customizedId="" beanClass="com.install4j.runtime.beans.screens.FormScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="1" finishScreen="false" wizardIndexChangeType="unchanged" wizardIndexKey="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.screens.FormScreen">
                      <void property="subTitle">
                        <string>${i18n:summary.screen.description("${compiler:sys.shortName}")}</string>
                      </void>
                      <void property="title">
                        <string>${i18n:summary.screen.title}</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>context.getBooleanVariable("express.install")</condition>
                <validation>if (context.isConsole()) 
{
    if (context.isUnattended())
    {
        return true;
    }   
    
    int response = Util.showOptionDialog("", new String[]{"Install", "Exit"}, JOptionPane.WARNING_MESSAGE);
    if (response != 0)
    {
        // if we are on console and user choses not to procede then we exit
        context.finish(0);
    }  
}

return true;</validation>
                <preActivation>context.getWizardContext().setNextButtonText("Install");</preActivation>
                <postActivation />
                <actions />
                <formComponents>
                  <formComponent name="InstallationDir" id="69785" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.KeyValuePairComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.formcomponents.KeyValuePairComponent">
                          <void property="labelText">
                            <string>${i18n:summary.installdir.label}</string>
                          </void>
                          <void property="valueLabelText">
                            <string>${installer:sys.installationDir}</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <initScript />
                    <visibilityScript />
                  </formComponent>
                  <formComponent name="HomeDir" id="69786" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.KeyValuePairComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.formcomponents.KeyValuePairComponent">
                          <void property="labelText">
                            <string>${i18n:summary.homedir.label}</string>
                          </void>
                          <void property="valueLabelText">
                            <string>${installer:app.jiraHome}</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <initScript />
                    <visibilityScript />
                  </formComponent>
                  <formComponent name="HTTP Port" id="69787" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.KeyValuePairComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.formcomponents.KeyValuePairComponent">
                          <void property="labelText">
                            <string>${i18n:summary.httpport.label}</string>
                          </void>
                          <void property="valueLabelText">
                            <string>${installer:httpPort}</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <initScript />
                    <visibilityScript />
                  </formComponent>
                  <formComponent name="RMI Port" id="69788" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.KeyValuePairComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.formcomponents.KeyValuePairComponent">
                          <void property="labelText">
                            <string>${i18n:summary.rmiport.label}</string>
                          </void>
                          <void property="valueLabelText">
                            <string>${installer:rmiPort}</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <initScript />
                    <visibilityScript />
                  </formComponent>
                  <formComponent name="service" id="69789" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.KeyValuePairComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.formcomponents.KeyValuePairComponent">
                          <void property="labelText">
                            <string>${i18n:summary.service.label}</string>
                          </void>
                          <void property="valueLabelText">
                            <string>${installer:app.install.service}</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <initScript>if (context.getBooleanVariable("app.install.service"))
{
    configurationObject.setText("Yes");
}
else
{
    configurationObject.setText("No");
}</initScript>
                    <visibilityScript />
                  </formComponent>
                </formComponents>
              </screen>
            </beans>
          </group>
          <group name="Upgrade Questions" id="66993" customizedId="" beanClass="com.install4j.runtime.beans.groups.ScreenGroup" enabled="true" commentSet="false" comment="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.groups.ScreenGroup">
                  <void property="conditionExpression">
                    <object class="com.install4j.api.beans.ScriptProperty">
                      <void property="value">
                        <string>return context.getBooleanVariable("sys.confirmedUpdateInstallation");</string>
                      </void>
                    </object>
                  </void>
                </object>
              </java>
            </serializedBean>
            <beans>
              <screen name="Optional Backup" id="67114" customizedId="" beanClass="com.install4j.runtime.beans.screens.BannerFormScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="1" finishScreen="false" wizardIndexChangeType="unchanged" wizardIndexKey="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.screens.BannerFormScreen">
                      <void property="bannerImageAnchor">
                        <object class="com.install4j.api.beans.Anchor" field="CENTER" />
                      </void>
                      <void property="bannerImageFile">
                        <object class="com.install4j.api.beans.ExternalFile">
                          <string>./images/jira_logo_large.png</string>
                        </object>
                      </void>
                      <void property="title">
                        <string>${i18n:upgrade.backup.title("${compiler:sys.shortName}")}</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
                <validation />
                <preActivation />
                <postActivation />
                <actions />
                <formComponents>
                  <formComponent name="" id="67115" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.MultilineLabelComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.formcomponents.MultilineLabelComponent">
                          <void property="labelText">
                            <string>${i18n:upgrade.backup.description("${compiler:sys.shortName}")}</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <initScript />
                    <visibilityScript />
                  </formComponent>
                  <formComponent name="" id="67116" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.CheckboxComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.formcomponents.CheckboxComponent">
                          <void property="checkboxText">
                            <string>${i18n:upgrade.backup.option("${compiler:sys.shortName}")}</string>
                          </void>
                          <void property="initiallySelected">
                            <boolean>true</boolean>
                          </void>
                          <void property="variableName">
                            <string>backupJira</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <initScript />
                    <visibilityScript />
                  </formComponent>
                </formComponents>
              </screen>
              <screen name="Modz detection" id="68345" customizedId="" beanClass="com.install4j.runtime.beans.screens.CustomizableProgressScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="2" finishScreen="false" wizardIndexChangeType="unchanged" wizardIndexKey="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.screens.CustomizableProgressScreen">
                      <void property="initialStatusMessage">
                        <string>${i18n:upgrade.modz.detection.info}...</string>
                      </void>
                      <void property="subTitle">
                        <string>${i18n:upgrade.modz.detection.info}</string>
                      </void>
                      <void property="title">
                        <string>${i18n:upgrade.modz.detection.title}</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
                <validation />
                <preActivation />
                <postActivation />
                <actions>
                  <action name="" id="68346" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.SetProgressAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="true" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.control.SetProgressAction">
                          <void property="progressChangeType">
                            <object class="com.install4j.runtime.beans.actions.control.ProgressChangeType" field="SET_INDETERMINATE" />
                          </void>
                          <void property="timerPeriod">
                            <int>500</int>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                  <action name="create modz report" id="68347" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="true" failureStrategy="1" errorMessage="${i18n:error.failed.modz.check}">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                          <void property="script">
                            <object class="com.install4j.api.beans.ScriptProperty">
                              <void property="value">
                                <string>import com.atlassian.inception.modz.ModificationHelper;
import com.atlassian.inception.UpgradeHelper;
import com.atlassian.inception.JiraUpgradeHelper;

String installDir = (String) context.getVariable("existingInstallationDir");
ModificationHelper modzHelper = ModificationHelper.createJiraHelper(installDir);
UpgradeHelper upgradeHelper = new JiraUpgradeHelper(installDir);

String currPlatformVersion = (String) upgradeHelper.getExistingInstallationVersion();
String fileName = (String) context.getVariable("existingInstallationDir") + "/../" + currPlatformVersion.replaceAll("\\s", "_") + "-modifications.txt";

try
{
    context.setVariable("detected.modz.file.name", fileName);

    List&lt;String&gt; allModz = modzHelper.saveModzFile(fileName);
    context.setVariable("anyModz", !allModz.isEmpty());
    context.setVariable("serverXml.modz", allModz.contains(ModificationHelper.SERVER_XML_FILE));

    return true;
}
catch (Exception e)
{
    Util.log(e);
    return false;
}
</string>
                              </void>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                </actions>
                <formComponents />
              </screen>
              <screen name="" id="68462" customizedId="" beanClass="com.install4j.runtime.beans.screens.CustomizableInfoScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="2" finishScreen="false" wizardIndexChangeType="unchanged" wizardIndexKey="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.screens.CustomizableInfoScreen">
                      <void property="displayedTextFile">
                        <void property="languageIdToExternalFile">
                          <void method="put">
                            <string>en</string>
                            <object class="com.install4j.api.beans.ExternalFile">
                              <string>${installer:detected.modz.file.name}</string>
                            </object>
                          </void>
                        </void>
                      </void>
                      <void property="subTitle">
                        <string>${i18n:file.modifications.subtitle("${compiler:sys.shortName}")}</string>
                      </void>
                      <void property="title">
                        <string>${i18n:file.modifications.title}</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>context.getBooleanVariable("anyModz")</condition>
                <validation />
                <preActivation />
                <postActivation />
                <actions />
                <formComponents />
              </screen>
              <screen name="Check if JIRA is running" id="68123" customizedId="" beanClass="com.install4j.runtime.beans.screens.CustomizableProgressScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="2" finishScreen="false" wizardIndexChangeType="unchanged" wizardIndexKey="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.screens.CustomizableProgressScreen">
                      <void property="initialStatusMessage">
                        <string>${i18n:upgrade.checkjira.info("${compiler:sys.shortName}")}...</string>
                      </void>
                      <void property="subTitle">
                        <string>${i18n:upgrade.checkjira.info("${compiler:sys.shortName}")}</string>
                      </void>
                      <void property="title">
                        <string>${i18n:upgrade.checkjira.title("${compiler:sys.shortName}")}</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
                <validation />
                <preActivation />
                <postActivation />
                <actions>
                  <action name="" id="68124" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.SetProgressAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="true" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.control.SetProgressAction">
                          <void property="progressChangeType">
                            <object class="com.install4j.runtime.beans.actions.control.ProgressChangeType" field="SET_INDETERMINATE" />
                          </void>
                          <void property="timerPeriod">
                            <int>500</int>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                  <action name="" id="68122" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="true" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                          <void property="script">
                            <object class="com.install4j.api.beans.ScriptProperty">
                              <void property="value">
                                <string>import com.atlassian.inception.TomcatChecker;
    
final int port = ((Long) context.getVariable("rmiPort")).intValue();

boolean isRunning = TomcatChecker.isTomcatRunning(port);
context.setVariable("jira.isrunning", isRunning);
return true;</string>
                              </void>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                </actions>
                <formComponents />
              </screen>
              <screen name="Upgrade Check List" id="66996" customizedId="" beanClass="com.install4j.runtime.beans.screens.BannerFormScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="1" finishScreen="false" wizardIndexChangeType="unchanged" wizardIndexKey="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.screens.BannerFormScreen">
                      <void property="bannerImageAnchor">
                        <object class="com.install4j.api.beans.Anchor" field="CENTER" />
                      </void>
                      <void property="bannerImageFile">
                        <object class="com.install4j.api.beans.ExternalFile">
                          <string>./images/warning.png</string>
                        </object>
                      </void>
                      <void property="scrollable">
                        <boolean>false</boolean>
                      </void>
                      <void property="title">
                        <string>${i18n:upgrade.check.list}</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
                <validation>boolean isRunning = context.getBooleanVariable("jira.isrunning");
if (isRunning || context.isConsole()) 
{
    if (context.isUnattended() )
    {
        return true;
    }
    
    String message = isRunning ? context.getMessage("upgrade.shutdown.warning", new Object[]{context.getCompilerVariable("sys.shortName")}) : context.getMessage("upgrade.about.to.proceed", new Object[]{context.getCompilerVariable("sys.shortName")});
    
    int response = Util.showOptionDialog(message, new String[]{context.getMessage("message.button.upgrade"), context.getMessage("message.button.exit")}, JOptionPane.WARNING_MESSAGE);
    if (!context.isConsole())
    {
        // return true if user clicks 'yes'
        return (response == 0); 
    }
    else if (response != 0)
    {
        // if we are on console and user choses not to procede then we exit
        context.finish(0);
    }  
}

return true;</validation>
                <preActivation>context.getWizardContext().setNextButtonText("Upgrade");</preActivation>
                <postActivation />
                <actions />
                <formComponents>
                  <group name="" id="69990" customizedId="" beanClass="com.install4j.runtime.beans.groups.VerticalFormComponentGroup" enabled="true" commentSet="false" comment="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.groups.VerticalFormComponentGroup" />
                      </java>
                    </serializedBean>
                    <beans>
                      <formComponent name="" id="66999" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.MultilineHtmlLabelComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                        <serializedBean>
                          <java class="java.beans.XMLDecoder">
                            <object class="com.install4j.runtime.beans.formcomponents.MultilineHtmlLabelComponent">
                              <void property="labelHtml">
                                <string>${i18n:warning.pre.upgrade.message.backup(${compiler:docs.version})}
</string>
                              </void>
                            </object>
                          </java>
                        </serializedBean>
                        <initScript>if (Util.isWindows()){
    configurationObject.setText(context.getMessage("warning.pre.upgrade.message.backup.windows", new Object[]{context.getCompilerVariable("docs.version"), context.getCompilerVariable("sys.shortName")}));
} else {
    configurationObject.setText(context.getMessage("warning.pre.upgrade.message.backup", new Object[]{context.getCompilerVariable("docs.version"), context.getCompilerVariable("sys.shortName")}));
} </initScript>
                        <visibilityScript />
                      </formComponent>
                      <formComponent name="" id="68346" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.MultilineHtmlLabelComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="true">
                        <serializedBean>
                          <java class="java.beans.XMLDecoder">
                            <object class="com.install4j.runtime.beans.formcomponents.MultilineHtmlLabelComponent">
                              <void property="labelHtml">
                                <string>${i18n:warning.pre.upgrade.message.jiradown}</string>
                              </void>
                            </object>
                          </java>
                        </serializedBean>
                        <initScript>boolean isRunning = context.getBooleanVariable("jira.isrunning");

if (isRunning) {
    String port = String.valueOf(context.getVariable("httpPort"));
    if (Util.isWindows()){
        configurationObject.setText(context.getMessage("warning.pre.upgrade.message.jiraup.windows", new Object[]{port,context.getCompilerVariable("docs.version"),context.getCompilerVariable("sys.fullName")}));
    } else {
        configurationObject.setText(context.getMessage("warning.pre.upgrade.message.jiraup", new Object[]{port,context.getCompilerVariable("docs.version"),context.getCompilerVariable("sys.fullName")}));
    }    
} else {
    if (Util.isWindows()){
           configurationObject.setText(context.getMessage("warning.pre.upgrade.message.jiradown.windows", new Object[]{context.getCompilerVariable("docs.version"),context.getCompilerVariable("sys.fullName")}));
       } else {
           configurationObject.setText(context.getMessage("warning.pre.upgrade.message.jiradown", new Object[]{context.getCompilerVariable("docs.version"),context.getCompilerVariable("sys.fullName")}));
       }
}</initScript>
                        <visibilityScript />
                      </formComponent>
                      <formComponent name="" id="69989" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.SpringComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                        <serializedBean>
                          <java class="java.beans.XMLDecoder">
                            <object class="com.install4j.runtime.beans.formcomponents.SpringComponent">
                              <void property="axisType">
                                <object class="com.install4j.runtime.beans.formcomponents.AxisType" field="VERTICAL" />
                              </void>
                            </object>
                          </java>
                        </serializedBean>
                        <initScript />
                        <visibilityScript />
                      </formComponent>
                      <group name="" id="69983" customizedId="" beanClass="com.install4j.runtime.beans.groups.HorizontalFormComponentGroup" enabled="true" commentSet="false" comment="">
                        <serializedBean>
                          <java class="java.beans.XMLDecoder">
                            <object class="com.install4j.runtime.beans.groups.HorizontalFormComponentGroup">
                              <void property="anchor">
                                <object class="com.install4j.api.beans.Anchor" field="NORTHWEST" />
                              </void>
                              <void property="insets">
                                <object class="java.awt.Insets">
                                  <int>10</int>
                                  <int>0</int>
                                  <int>0</int>
                                  <int>0</int>
                                </object>
                              </void>
                              <void property="visibilityScript">
                                <object class="com.install4j.api.beans.ScriptProperty">
                                  <void property="value">
                                    <string />
                                  </void>
                                </object>
                              </void>
                            </object>
                          </java>
                        </serializedBean>
                        <beans>
                          <formComponent name="" id="69984" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.LabelComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                            <serializedBean>
                              <java class="java.beans.XMLDecoder">
                                <object class="com.install4j.runtime.beans.formcomponents.LabelComponent">
                                  <void property="labelIconFile">
                                    <object class="com.install4j.api.beans.ExternalFile">
                                      <string>./images/warning16x16.png</string>
                                    </object>
                                  </void>
                                </object>
                              </java>
                            </serializedBean>
                            <initScript />
                            <visibilityScript />
                          </formComponent>
                          <formComponent name="" id="69986" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.MultilineHtmlLabelComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                            <serializedBean>
                              <java class="java.beans.XMLDecoder">
                                <object class="com.install4j.runtime.beans.formcomponents.MultilineHtmlLabelComponent">
                                  <void property="labelHtml">
                                    <string>${i18n:warning.pre.upgrade.footer}</string>
                                  </void>
                                </object>
                              </java>
                            </serializedBean>
                            <initScript />
                            <visibilityScript />
                          </formComponent>
                        </beans>
                      </group>
                    </beans>
                  </group>
                </formComponents>
              </screen>
              <screen name="Upgrade Actions" id="67235" customizedId="" beanClass="com.install4j.runtime.beans.screens.CustomizableProgressScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="2" finishScreen="false" wizardIndexChangeType="unchanged" wizardIndexKey="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.screens.CustomizableProgressScreen">
                      <void property="initialStatusMessage">
                        <string />
                      </void>
                      <void property="subTitle">
                        <string>${i18n:upgrade.actions.info("${compiler:sys.shortName}")}</string>
                      </void>
                      <void property="title">
                        <string>${i18n:upgrade.actions.title("${compiler:sys.shortName}")}</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
                <validation />
                <preActivation />
                <postActivation />
                <actions>
                  <action name="Set knightrider to whilst attempting to shutdown" id="68236" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.SetProgressAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="true" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.control.SetProgressAction">
                          <void property="progressChangeType">
                            <object class="com.install4j.runtime.beans.actions.control.ProgressChangeType" field="SET_INDETERMINATE" />
                          </void>
                          <void property="timerPeriod">
                            <int>500</int>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                  <action name="Set JIRA shutdown message" id="67243" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.SetMessageAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.control.SetMessageAction">
                          <void property="statusMessage">
                            <string>${i18n:upgrade.shutdown.desc("${compiler:sys.shortName}")}</string>
                          </void>
                          <void property="useStatus">
                            <boolean>true</boolean>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>return context.getBooleanVariable("jira.isrunning");</condition>
                  </action>
                  <action name="set shutdown script name" id="68864" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.SetVariableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.control.SetVariableAction">
                          <void property="script">
                            <object class="com.install4j.api.beans.ScriptProperty">
                              <void property="value">
                                <string>if (Util.isWindows())
{
    // try to use shutdown_bundled_jre.bat if it exists 
    String installDir = (String) context.getVariable("existingInstallationDir");
    
    if (new File(installDir, "shutdown_bundled_jre.bat").exists())
    {
        return "shutdown_bundled_jre.bat";
    }
    else
    {
        return "bin\\stop-jira.bat";
    }
}
else
{
    return "bin/stop-jira.sh";
}</string>
                              </void>
                            </object>
                          </void>
                          <void property="variableName">
                            <string>shutdown.script.name</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                  <action name="Shutdown JIRA" id="67237" customizedId="" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                          <void property="executable">
                            <object class="java.io.File">
                              <string>${installer:shutdown.script.name}</string>
                            </object>
                          </void>
                          <void property="wait">
                            <boolean>true</boolean>
                          </void>
                          <void property="workingDirectory">
                            <object class="java.io.File">
                              <string>.</string>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>return context.getBooleanVariable("jira.isrunning");</condition>
                  </action>
                  <action name="Set check JIRA shutdown message" id="68582" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.SetMessageAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.control.SetMessageAction">
                          <void property="statusMessage">
                            <string>${i18n:upgrade.shutdown.check("${compiler:sys.shortName}")}</string>
                          </void>
                          <void property="useStatus">
                            <boolean>true</boolean>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                  <action name="Check jira is shut" id="68017" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="2" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                          <void property="script">
                            <object class="com.install4j.api.beans.ScriptProperty">
                              <void property="value">
                                <string>import com.atlassian.inception.TomcatChecker;

final int port = (int) ((Long) context.getVariable("rmiPort")).longValue();

boolean shutDown = !TomcatChecker.isTomcatRunning(port);

while (!shutDown)
{
    int ret = Util.showOptionDialog(context.getMessage("shutdown.failed.please.do.it.manually", new Object[]{context.getCompilerVariable("sys.shortName")}), new String[]{context.getMessage("message.button.continue"), context.getMessage("message.button.exit")}, JOptionPane.WARNING_MESSAGE);
    if (ret == 1) //user selected to exit
    {
        return false; //this will rollback everyting
    }
    shutDown = !TomcatChecker.isTomcatRunning(port);
}

return true;
</string>
                              </void>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                  <action name="Back to normal proressbar" id="68345" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.SetProgressAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.control.SetProgressAction">
                          <void property="progressChangeType">
                            <object class="com.install4j.runtime.beans.actions.control.ProgressChangeType" field="SET_DETERMINATE" />
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                  <group name="Check user after upgrade" id="69177" customizedId="" beanClass="com.install4j.runtime.beans.groups.ActionGroup" enabled="true" commentSet="false" comment="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.groups.ActionGroup">
                          <void property="conditionExpression">
                            <object class="com.install4j.api.beans.ScriptProperty">
                              <void property="value">
                                <string>return !Util.isWindows() &amp;&amp; Util.isAdminUser(); </string>
                              </void>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <beans>
                      <action name="Set jiraAccountName if it exists" id="69178" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.SetVariableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                        <serializedBean>
                          <java class="java.beans.XMLDecoder">
                            <object class="com.install4j.runtime.beans.actions.control.SetVariableAction">
                              <void property="onlyIfUndefined">
                                <boolean>true</boolean>
                              </void>
                              <void property="script">
                                <object class="com.install4j.api.beans.ScriptProperty">
                                  <void property="value">
                                    <string>import com.atlassian.inception.UpgradeHelper;
import com.atlassian.inception.JiraUpgradeHelper;

String installDir = (String) context.getVariable("existingInstallationDir");
UpgradeHelper upgradeHelper = new JiraUpgradeHelper(installDir);

return upgradeHelper.getUser();</string>
                                  </void>
                                </object>
                              </void>
                              <void property="variableName">
                                <string>jiraAccountName</string>
                              </void>
                            </object>
                          </java>
                        </serializedBean>
                        <condition />
                      </action>
                      <action name="Set isNormalUserInstall" id="69183" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.SetVariableAction" enabled="true" commentSet="true" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                        <serializedBean>
                          <java class="java.beans.XMLDecoder">
                            <object class="com.install4j.runtime.beans.actions.control.SetVariableAction">
                              <void property="script">
                                <object class="com.install4j.api.beans.ScriptProperty">
                                  <void property="value">
                                    <string>String jiraAccountName = (String) context.getVariable("jiraAccountName");
boolean isNormalUserInstall = jiraAccountName == null || "".equals(jiraAccountName);

// We couldn't get a dedicated jiraAccountName, so must've been normal user install
if (isNormalUserInstall)
{
    // Set the 'jiraAccountName' for later use
    String installDir = (String) context.getVariable("existingInstallationDir");
    File installDirFile = new File(installDir);
    String ownerGroupName = UnixFileSystem.getFileInformation(installDirFile).getOwnerInfo();
    String ownerName = ownerGroupName.split(":")[0]; // owner is in format user:group - we only want username here
    context.setVariable("jiraAccountName", ownerName);    
}
return isNormalUserInstall;
</string>
                                  </void>
                                </object>
                              </void>
                              <void property="variableName">
                                <string>isNormalUserInstall</string>
                              </void>
                            </object>
                          </java>
                        </serializedBean>
                        <condition />
                      </action>
                    </beans>
                  </group>
                  <action name="Set create installdir zip msg" id="67525" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.SetMessageAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.control.SetMessageAction">
                          <void property="statusMessage">
                            <string>${i18n:upgrade.backup.installationdir("${compiler:sys.shortName}")}</string>
                          </void>
                          <void property="useStatus">
                            <boolean>true</boolean>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                  <action name="Create an installdir zip" id="67523" customizedId="" beanClass="com.install4j.runtime.beans.actions.files.CreateZipFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="3" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.files.CreateZipFileAction">
                          <void property="addTopLevelDirectoriesToRelativePath">
                            <boolean>true</boolean>
                          </void>
                          <void property="files">
                            <array class="java.io.File" length="1">
                              <void index="0">
                                <object class="java.io.File">
                                  <string>${installer:existingInstallationDir}</string>
                                </object>
                              </void>
                            </array>
                          </void>
                          <void property="showProgress">
                            <boolean>true</boolean>
                          </void>
                          <void property="zipFile">
                            <object class="java.io.File">
                              <string>${installer:backup.installationDir}</string>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                  <action name="Set create JIRA home zip msg" id="67620" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.SetMessageAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.control.SetMessageAction">
                          <void property="statusMessage">
                            <string>${i18n:upgrade.backup.jirahome("${compiler:sys.shortName}")}</string>
                          </void>
                          <void property="useStatus">
                            <boolean>true</boolean>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>context.getBooleanVariable("backupJira")</condition>
                  </action>
                  <action name="Create JIRA home zip" id="67621" customizedId="" beanClass="com.install4j.runtime.beans.actions.files.CreateZipFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="3" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.files.CreateZipFileAction">
                          <void property="addTopLevelDirectoriesToRelativePath">
                            <boolean>true</boolean>
                          </void>
                          <void property="files">
                            <array class="java.io.File" length="1">
                              <void index="0">
                                <object class="java.io.File">
                                  <string>${installer:app.jiraHome}</string>
                                </object>
                              </void>
                            </array>
                          </void>
                          <void property="showProgress">
                            <boolean>true</boolean>
                          </void>
                          <void property="zipFile">
                            <object class="java.io.File">
                              <string>${installer:app.backup.jiraHome}</string>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>context.getBooleanVariable("backupJira")</condition>
                  </action>
                  <action name="Set delete install dir msg" id="67526" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.SetMessageAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.control.SetMessageAction">
                          <void property="statusMessage">
                            <string>${i18n:upgrade.backup.del.installationdir("${compiler:sys.shortName}")}</string>
                          </void>
                          <void property="useStatus">
                            <boolean>true</boolean>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                  <action name="" id="68982" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.SetProgressAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.control.SetProgressAction">
                          <void property="progressChangeType">
                            <object class="com.install4j.runtime.beans.actions.control.ProgressChangeType" field="SET_INDETERMINATE" />
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                  <action name="copy hsql db" id="68122" customizedId="" beanClass="com.install4j.runtime.beans.actions.files.CopyFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="3" errorMessage="Failed to copy data inside hsql database.">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.files.CopyFileAction">
                          <void property="destinationFile">
                            <object class="java.io.File">
                              <string>${installer:app.jiraHome}/database</string>
                            </object>
                          </void>
                          <void property="files">
                            <array class="java.io.File" length="1">
                              <void index="0">
                                <object class="java.io.File">
                                  <string>${installer:existingInstallationDir}/database</string>
                                </object>
                              </void>
                            </array>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>import com.atlassian.inception.JiraDbConfigMigrator;

JiraDbConfigMigrator.DbConfigBean bean = (JiraDbConfigMigrator.DbConfigBean) context.getVariable("db.config.bean");

return bean != null &amp;&amp; "hsql".equals(bean.getDatabaseType());</condition>
                  </action>
                  <group name="Uninstall version on Win" id="69530" customizedId="" beanClass="com.install4j.runtime.beans.groups.ActionGroup" enabled="true" commentSet="false" comment="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.groups.ActionGroup">
                          <void property="conditionExpression">
                            <object class="com.install4j.api.beans.ScriptProperty">
                              <void property="value">
                                <string>String groupName = (String) context.getVariable("sys.programGroupName");
boolean uninstallFirst = groupName != null &amp;&amp; !groupName.isEmpty() &amp;&amp; Util.isWindows();
context.setVariable("oldWinVersionUninstalled", uninstallFirst); 

return uninstallFirst;
</string>
                              </void>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <beans>
                      <action name="Stop Service" id="70627" customizedId="" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                        <serializedBean>
                          <java class="java.beans.XMLDecoder">
                            <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                              <void property="executable">
                                <object class="java.io.File">
                                  <string>stop_service.bat</string>
                                </object>
                              </void>
                              <void property="wait">
                                <boolean>true</boolean>
                              </void>
                              <void property="workingDirectory">
                                <object class="java.io.File">
                                  <string>.</string>
                                </object>
                              </void>
                            </object>
                          </java>
                        </serializedBean>
                        <condition>context.getBooleanVariable("app.install.service")</condition>
                      </action>
                      <action name="Windows - give the service time to stop" id="70628" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.SleepAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                        <serializedBean>
                          <java class="java.beans.XMLDecoder">
                            <object class="com.install4j.runtime.beans.actions.control.SleepAction">
                              <void property="sleepTimeMs">
                                <int>2000</int>
                              </void>
                            </object>
                          </java>
                        </serializedBean>
                        <condition />
                      </action>
                      <action name="Remove Service" id="69529" customizedId="" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                        <serializedBean>
                          <java class="java.beans.XMLDecoder">
                            <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                              <void property="arguments">
                                <array class="java.lang.String" length="1">
                                  <void index="0">
                                    <string>remove</string>
                                  </void>
                                </array>
                              </void>
                              <void property="executable">
                                <object class="java.io.File">
                                  <string>bin/service.bat</string>
                                </object>
                              </void>
                              <void property="wait">
                                <boolean>true</boolean>
                              </void>
                              <void property="workingDirectory">
                                <object class="java.io.File">
                                  <string>.</string>
                                </object>
                              </void>
                            </object>
                          </java>
                        </serializedBean>
                        <condition>context.getBooleanVariable("app.install.service")</condition>
                      </action>
                      <action name="" id="69528" customizedId="" beanClass="com.install4j.runtime.beans.actions.UninstallPreviousAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                        <serializedBean>
                          <java class="java.beans.XMLDecoder">
                            <object class="com.install4j.runtime.beans.actions.UninstallPreviousAction">
                              <void property="onlyIfSameApplicationId">
                                <boolean>false</boolean>
                              </void>
                            </object>
                          </java>
                        </serializedBean>
                        <condition />
                      </action>
                      <action name="" id="69534" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.SetVariableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                        <serializedBean>
                          <java class="java.beans.XMLDecoder">
                            <object class="com.install4j.runtime.beans.actions.control.SetVariableAction">
                              <void property="script">
                                <object class="com.install4j.api.beans.ScriptProperty">
                                  <void property="value">
                                    <string>return (String) context.getCompilerVariable("sys.shortName");</string>
                                  </void>
                                </object>
                              </void>
                              <void property="variableName">
                                <string>sys.programGroupName</string>
                              </void>
                            </object>
                          </java>
                        </serializedBean>
                        <condition />
                      </action>
                    </beans>
                  </group>
                  <action name="" id="67524" customizedId="" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="true" failureStrategy="4" errorMessage="${i18n:error.deleting.previous.install}">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                          <void property="backupForRollback">
                            <boolean>false</boolean>
                          </void>
                          <void property="files">
                            <array class="java.io.File" length="1">
                              <void index="0">
                                <object class="java.io.File">
                                  <string>${installer:existingInstallationDir}</string>
                                </object>
                              </void>
                            </array>
                          </void>
                          <void property="recursive">
                            <boolean>true</boolean>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                </actions>
                <formComponents />
              </screen>
              <screen name="Temp Screen. Remove before releases" id="67239" customizedId="" beanClass="com.install4j.runtime.beans.screens.CustomizableInfoScreen" enabled="false" commentSet="false" comment="" rollbackBarrier="false" backButton="2" finishScreen="false" wizardIndexChangeType="unchanged" wizardIndexKey="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.screens.CustomizableInfoScreen">
                      <void property="displayedText">
                        <string>Temp screen to help us with testing the upgrader.

Cancel here to prevent the installer from blindly going through the 'installation' steps.

REMEMBER TO REMOVE SCREEN WHEN ALL IS DONE!</string>
                      </void>
                      <void property="subTitle">
                        <string>Not really here...you're just dreaming!</string>
                      </void>
                      <void property="textSource">
                        <object class="com.install4j.runtime.beans.screens.components.TextSource" field="DIRECT" />
                      </void>
                      <void property="title">
                        <string>Temp Screen</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
                <validation />
                <preActivation />
                <postActivation />
                <actions />
                <formComponents />
              </screen>
            </beans>
          </group>
          <screen name="" id="5" customizedId="" beanClass="com.install4j.runtime.beans.screens.InstallationScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="true" backButton="2" finishScreen="false" wizardIndexChangeType="unchanged" wizardIndexKey="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.screens.InstallationScreen" />
              </java>
            </serializedBean>
            <condition />
            <validation />
            <preActivation />
            <postActivation />
            <actions>
              <action name="Set programGroupName if undefined" id="69299" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.SetVariableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.SetVariableAction">
                      <void property="onlyIfUndefined">
                        <boolean>true</boolean>
                      </void>
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>context.getCompilerVariable("sys.shortName")</string>
                          </void>
                        </object>
                      </void>
                      <void property="variableName">
                        <string>sys.programGroupName</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>Util.isWindows()</condition>
              </action>
              <action name="Set httpPort" id="59972" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.SetVariableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.SetVariableAction">
                      <void property="onlyIfUndefined">
                        <boolean>true</boolean>
                      </void>
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>return Long.parseLong(context.getCompilerVariable("app.httpPort"));</string>
                          </void>
                        </object>
                      </void>
                      <void property="variableName">
                        <string>httpPort</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="Set rmiPort" id="59973" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.SetVariableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.SetVariableAction">
                      <void property="onlyIfUndefined">
                        <boolean>true</boolean>
                      </void>
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>return Long.parseLong(context.getCompilerVariable("app.rmiPort"));</string>
                          </void>
                        </object>
                      </void>
                      <void property="variableName">
                        <string>rmiPort</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="Set installationID" id="59886" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.SetVariableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.SetVariableAction">
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>import java.text.SimpleDateFormat;
import java.util.Date;

SimpleDateFormat format = new SimpleDateFormat("ddMMyyHHmmss");
String productNameWithoutSpaces = context.getCompilerVariable("sys.shortName").replaceAll( "\\s", "");

return productNameWithoutSpaces + format.format(new Date());</string>
                          </void>
                        </object>
                      </void>
                      <void property="variableName">
                        <string>installationID</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>// don't generate new id on upgrade, unless there is no pre-existing ID
String installationID = (String) context.getVariable("installationID");
return (!context.getBooleanVariable("sys.confirmedUpdateInstallation") || installationID==null);</condition>
              </action>
              <action name="" id="6" customizedId="" beanClass="com.install4j.runtime.beans.actions.InstallFilesAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="2" errorMessage="${i18n:FileCorrupted}">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.InstallFilesAction" />
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="" id="65555" customizedId="" beanClass="com.install4j.runtime.beans.actions.files.CopyFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="true" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.CopyFileAction">
                      <void property="destinationFile">
                        <object class="java.io.File">
                          <string>${installer:sys.installationDir}/bin/msvcr71.dll</string>
                        </object>
                      </void>
                      <void property="files">
                        <array class="java.io.File" length="1">
                          <void index="0">
                            <object class="java.io.File">
                              <string>${installer:sys.installationDir}/jre/bin/msvcr71.dll</string>
                            </object>
                          </void>
                        </array>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="" id="66248" customizedId="" beanClass="com.install4j.runtime.beans.actions.files.SetModeAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="${i18n:error.chmod.sh.files}">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.SetModeAction">
                      <void property="fileFilter">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>return file.getName().endsWith(".sh");</string>
                          </void>
                        </object>
                      </void>
                      <void property="files">
                        <array class="java.io.File" length="1">
                          <void index="0">
                            <object class="java.io.File">
                              <string>bin</string>
                            </object>
                          </void>
                        </array>
                      </void>
                      <void property="mode">
                        <string>u+x</string>
                      </void>
                      <void property="recursive">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="Update httpPort in Launch.url" id="59981" customizedId="" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                      <void property="files">
                        <array class="java.io.File" length="1">
                          <void index="0">
                            <object class="java.io.File">
                              <string>Launch JIRA in browser.url</string>
                            </object>
                          </void>
                        </array>
                      </void>
                      <void property="replaceValue">
                        <string>${installer:httpPort}</string>
                      </void>
                      <void property="searchValue">
                        <string>@httpPort@</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>Util.isWindows()</condition>
              </action>
              <action name="Set CATALINA_HOME in service.bat" id="65476" customizedId="" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                      <void property="files">
                        <array class="java.io.File" length="1">
                          <void index="0">
                            <object class="java.io.File">
                              <string>bin/service.bat</string>
                            </object>
                          </void>
                        </array>
                      </void>
                      <void property="replaceValue">
                        <string>set CATALINA_HOME=${installer:sys.installationDir}</string>
                      </void>
                      <void property="searchValue">
                        <string>rem Guess CATALINA_HOME if not defined</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>return Util.isWindows();</condition>
              </action>
              <action name="Set SERVICE_NAME in service.bat" id="59877" customizedId="" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                      <void property="files">
                        <array class="java.io.File" length="1">
                          <void index="0">
                            <object class="java.io.File">
                              <string>bin/service.bat</string>
                            </object>
                          </void>
                        </array>
                      </void>
                      <void property="replaceValue">
                        <string>SERVICE_NAME=${installer:installationID}</string>
                      </void>
                      <void property="searchValue">
                        <string>SERVICE_NAME=JIRA</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>return Util.isWindows();</condition>
              </action>
              <action name="Set JIRA Version in service.bat" id="59887" customizedId="" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                      <void property="files">
                        <array class="java.io.File" length="1">
                          <void index="0">
                            <object class="java.io.File">
                              <string>bin/service.bat</string>
                            </object>
                          </void>
                        </array>
                      </void>
                      <void property="replaceValue">
                        <string>Atlassian JIRA Server [${installer:sys.programGroupName}]</string>
                      </void>
                      <void property="searchValue">
                        <string>Atlassian JIRA Server</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>return Util.isWindows();</condition>
              </action>
              <action name="Set PR_DISPLAYNAME in service.bat" id="59888" customizedId="" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                      <void property="failIfNoReplacement">
                        <boolean>true</boolean>
                      </void>
                      <void property="files">
                        <array class="java.io.File" length="1">
                          <void index="0">
                            <object class="java.io.File">
                              <string>bin/service.bat</string>
                            </object>
                          </void>
                        </array>
                      </void>
                      <void property="replaceValue">
                        <string>PR_DISPLAYNAME=Atlassian ${installer:sys.programGroupName}</string>
                      </void>
                      <void property="searchValue">
                        <string>PR_DISPLAYNAME=Atlassian JIRA</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>return Util.isWindows();</condition>
              </action>
              <action name="Set PR_DESCRIPTION in service.bat" id="66149" customizedId="" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                      <void property="failIfNoReplacement">
                        <boolean>true</boolean>
                      </void>
                      <void property="files">
                        <array class="java.io.File" length="1">
                          <void index="0">
                            <object class="java.io.File">
                              <string>bin/service.bat</string>
                            </object>
                          </void>
                        </array>
                      </void>
                      <void property="replaceValue">
                        <string>http://localhost:${installer:httpPort}/</string>
                      </void>
                      <void property="searchValue">
                        <string>http://localhost:8080/</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>return Util.isWindows();</condition>
              </action>
              <action name="Modify JAVA_HOME to installationDir in permgen.bat" id="65596" customizedId="" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                      <void property="files">
                        <array class="java.io.File" length="1">
                          <void index="0">
                            <object class="java.io.File">
                              <string>bin/permgen.bat</string>
                            </object>
                          </void>
                        </array>
                      </void>
                      <void property="replaceValue">
                        <string>IF NOT "${installer:sys.installationDir}\jre\" == "" GOTO gotJavaHome </string>
                      </void>
                      <void property="searchValue">
                        <string>IF NOT "%JAVA_HOME%" == "" GOTO gotJavaHome</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>return Util.isWindows();</condition>
              </action>
              <action name="Modify JAVA_HOME to installationDir in permgen.sh" id="66786" customizedId="" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                      <void property="files">
                        <array class="java.io.File" length="1">
                          <void index="0">
                            <object class="java.io.File">
                              <string>bin/permgen.sh</string>
                            </object>
                          </void>
                        </array>
                      </void>
                      <void property="replaceValue">
                        <string>JAVA_HOME="${installer:sys.installationDir}/jre/"; export JAVA_HOME</string>
                      </void>
                      <void property="searchValue">
                        <string># !INSTALLER SET JAVA_HOME</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>return Util.isLinux();</condition>
              </action>
              <action name="Modify JavaPath to installationDir in permgen.bat" id="65523" customizedId="" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                      <void property="files">
                        <array class="java.io.File" length="1">
                          <void index="0">
                            <object class="java.io.File">
                              <string>bin/permgen.bat</string>
                            </object>
                          </void>
                        </array>
                      </void>
                      <void property="replaceValue">
                        <string>"${installer:sys.installationDir}\jre\bin\java" -version 2&gt;&amp;1 | FINDSTR IBM</string>
                      </void>
                      <void property="searchValue">
                        <string>"%javaPath%\java.exe" -version 2&gt;&amp;1 | FINDSTR IBM</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>return Util.isWindows();</condition>
              </action>
              <action name="Ignore JAVA_HOME in service.bat" id="70998" customizedId="" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                      <void property="files">
                        <array class="java.io.File" length="1">
                          <void index="0">
                            <object class="java.io.File">
                              <string>bin/service.bat</string>
                            </object>
                          </void>
                        </array>
                      </void>
                      <void property="replaceValue">
                        <string>rem if not "%JAVA_HOME%" == "" goto gotJdkHome</string>
                      </void>
                      <void property="searchValue">
                        <string>if not "%JAVA_HOME%" == "" goto gotJdkHome</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>Util.isWindows()</condition>
              </action>
              <action name="Ignoring JAVA_HOME in service.bat" id="65524" customizedId="" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                      <void property="files">
                        <array class="java.io.File" length="1">
                          <void index="0">
                            <object class="java.io.File">
                              <string>bin/service.bat</string>
                            </object>
                          </void>
                        </array>
                      </void>
                      <void property="replaceValue">
                        <string>Ignoring JAVA_HOME:</string>
                      </void>
                      <void property="searchValue">
                        <string>Using JAVA_HOME:</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>return Util.isWindows();</condition>
              </action>
              <action name="Insert service id into start_service.bat" id="65304" customizedId="" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                      <void property="files">
                        <array class="java.io.File" length="1">
                          <void index="0">
                            <object class="java.io.File">
                              <string>start_service.bat</string>
                            </object>
                          </void>
                        </array>
                      </void>
                      <void property="replaceValue">
                        <string>${installer:installationID}</string>
                      </void>
                      <void property="searchValue">
                        <string>&lt;jira_service_id&gt;</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>return Util.isWindows();</condition>
              </action>
              <action name="Remove tomcat URL from service.bat" id="65356" customizedId="" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                      <void property="files">
                        <array class="java.io.File" length="1">
                          <void index="0">
                            <object class="java.io.File">
                              <string>bin/service.bat</string>
                            </object>
                          </void>
                        </array>
                      </void>
                      <void property="searchValue">
                        <string>- http://tomcat.apache.org</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>return Util.isWindows();</condition>
              </action>
              <action name="Update httpPort in server.xml" id="59970" customizedId="" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                      <void property="files">
                        <array class="java.io.File" length="1">
                          <void index="0">
                            <object class="java.io.File">
                              <string>conf/server.xml</string>
                            </object>
                          </void>
                        </array>
                      </void>
                      <void property="replaceValue">
                        <string>&lt;Connector port="${installer:httpPort}"</string>
                      </void>
                      <void property="searchValue">
                        <string>&lt;Connector port="8080"</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="Insert service id into stop_service.bat" id="65328" customizedId="" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                      <void property="files">
                        <array class="java.io.File" length="1">
                          <void index="0">
                            <object class="java.io.File">
                              <string>stop_service.bat</string>
                            </object>
                          </void>
                        </array>
                      </void>
                      <void property="replaceValue">
                        <string>${installer:installationID}</string>
                      </void>
                      <void property="searchValue">
                        <string>&lt;jira_service_id&gt;</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>return Util.isWindows();</condition>
              </action>
              <action name="Update rmiPort in server.xml" id="59971" customizedId="" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                      <void property="files">
                        <array class="java.io.File" length="1">
                          <void index="0">
                            <object class="java.io.File">
                              <string>conf/server.xml</string>
                            </object>
                          </void>
                        </array>
                      </void>
                      <void property="replaceValue">
                        <string>&lt;Server port="${installer:rmiPort}"</string>
                      </void>
                      <void property="searchValue">
                        <string>&lt;Server port="8005"</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="Set JIRA Home in application properties" id="69086" customizedId="" beanClass="com.install4j.runtime.beans.actions.text.RegexTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="${i18n:error.setting.jira.home(&quot;${compiler:sys.shortName}&quot;)}">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.RegexTextFileAction">
                      <void property="escapeForPropertyFile">
                        <boolean>true</boolean>
                      </void>
                      <void property="failIfNoReplacement">
                        <boolean>true</boolean>
                      </void>
                      <void property="files">
                        <array class="java.io.File" length="1">
                          <void index="0">
                            <object class="java.io.File">
                              <string>atlassian-jira/WEB-INF/classes/jira-application.properties</string>
                            </object>
                          </void>
                        </array>
                      </void>
                      <void property="regex">
                        <string>(?m)jira.home\s*=.*?$</string>
                      </void>
                      <void property="replacement">
                        <string>jira.home = ${installer:app.jiraHome}</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="Undo extra-escaping of jira.home" id="65935" customizedId="" beanClass="com.install4j.runtime.beans.actions.text.RegexTextFileAction" enabled="true" commentSet="true" comment="Because we have &quot;Escape for properties&quot; set in the previous step install4j does some extra escaping that we don't really want&#xA;&#xA;jira.home =&#xA;&#xA;turns into&#xA;&#xA;jira.home \= /path/selected/in/installer&#xA;&#xA;This removes that extra backslash.&#xA;&#xA;Don't fail if no replacement has been made, because it seems like install4j doesn't always add the extra slash before the equal sign." rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.RegexTextFileAction">
                      <void property="encoding">
                        <string />
                      </void>
                      <void property="files">
                        <array class="java.io.File" length="1">
                          <void index="0">
                            <object class="java.io.File">
                              <string>atlassian-jira/WEB-INF/classes/jira-application.properties</string>
                            </object>
                          </void>
                        </array>
                      </void>
                      <void property="quoteVariables">
                        <boolean>false</boolean>
                      </void>
                      <void property="regex">
                        <string>jira.home \\=</string>
                      </void>
                      <void property="replacement">
                        <string>jira.home =</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="" id="8" customizedId="" beanClass="com.install4j.runtime.beans.actions.desktop.RegisterAddRemoveAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="${i18n:error.registering.in.win.program.list(${compiler:sys.fullName})}">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.desktop.RegisterAddRemoveAction">
                      <void property="itemName">
                        <string>${compiler:sys.fullName}</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>return Util.isWindows();</condition>
              </action>
              <group name="" id="66893" customizedId="" beanClass="com.install4j.runtime.beans.groups.ActionGroup" enabled="true" commentSet="false" comment="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.groups.ActionGroup">
                      <void property="conditionExpression">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>// for now only execute these actions on install and not on upgrade
// TODO we will have update shortcuts on upgrade
return !context.getBooleanVariable("sys.confirmedUpdateInstallation");</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <beans>
                  <action name="" id="68983" customizedId="" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                          <void property="arguments">
                            <array class="java.lang.String" length="1">
                              <void index="0">
                                <string>-s</string>
                              </void>
                            </array>
                          </void>
                          <void property="executable">
                            <object class="java.io.File">
                              <string>bin/setup_user.sh</string>
                            </object>
                          </void>
                          <void property="logArguments">
                            <boolean>true</boolean>
                          </void>
                          <void property="returnCodeVariable">
                            <string>jiraAccountNameSuffix</string>
                          </void>
                          <void property="wait">
                            <boolean>true</boolean>
                          </void>
                          <void property="workingDirectory">
                            <object class="java.io.File">
                              <string>.</string>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>return Util.isLinux();</condition>
                  </action>
                  <action name="set jira user account name" id="68984" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                          <void property="script">
                            <object class="com.install4j.api.beans.ScriptProperty">
                              <void property="value">
                                <string>int num = (Integer)context.getVariable("jiraAccountNameSuffix");

String suffix = num == 0 ? "" : Integer.toString(num);

context.setVariable("jiraAccountName", "jira" + suffix);
return true;</string>
                              </void>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>return Util.isLinux() &amp;&amp; Util.isAdminUser();</condition>
                  </action>
                  <action name="Linux: set username in user.sh" id="67235" customizedId="" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="3" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                          <void property="failIfNoReplacement">
                            <boolean>true</boolean>
                          </void>
                          <void property="files">
                            <array class="java.io.File" length="1">
                              <void index="0">
                                <object class="java.io.File">
                                  <string>bin/user.sh</string>
                                </object>
                              </void>
                            </array>
                          </void>
                          <void property="replaceValue">
                            <string>JIRA_USER="${installer:jiraAccountName}" # user created by installer</string>
                          </void>
                          <void property="searchValue">
                            <string>JIRA_USER="" ##</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>return Util.isLinux() &amp;&amp; Util.isAdminUser();</condition>
                  </action>
                  <action name="Install Linux service" id="66678" customizedId="" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                          <void property="executable">
                            <object class="java.io.File">
                              <string>bin/install_linux_service.sh</string>
                            </object>
                          </void>
                          <void property="failOnRedirectionError">
                            <boolean>true</boolean>
                          </void>
                          <void property="logArguments">
                            <boolean>true</boolean>
                          </void>
                          <void property="wait">
                            <boolean>true</boolean>
                          </void>
                          <void property="workingDirectory">
                            <object class="java.io.File">
                              <string>.</string>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>return Util.isLinux() &amp;&amp; context.getBooleanVariable("app.install.service");</condition>
                  </action>
                  <action name="Install Windows service" id="59876" customizedId="" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                          <void property="arguments">
                            <array class="java.lang.String" length="1">
                              <void index="0">
                                <string>install</string>
                              </void>
                            </array>
                          </void>
                          <void property="executable">
                            <object class="java.io.File">
                              <string>bin/service.bat</string>
                            </object>
                          </void>
                          <void property="wait">
                            <boolean>true</boolean>
                          </void>
                          <void property="workingDirectory">
                            <object class="java.io.File">
                              <string>.</string>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>return (Util.isWindows() &amp;&amp; context.getBooleanVariable("app.install.service"));</condition>
                  </action>
                  <action name="Configure Linux Security" id="66992" customizedId="" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="3" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                          <void property="arguments">
                            <array class="java.lang.String" length="4">
                              <void index="0">
                                <string>-d</string>
                              </void>
                              <void index="1">
                                <string>${installer:app.jiraHome}</string>
                              </void>
                              <void index="2">
                                <string>-i</string>
                              </void>
                              <void index="3">
                                <string>${installer:sys.installationDir}</string>
                              </void>
                            </array>
                          </void>
                          <void property="executable">
                            <object class="java.io.File">
                              <string>bin/setup_user.sh</string>
                            </object>
                          </void>
                          <void property="failOnRedirectionError">
                            <boolean>true</boolean>
                          </void>
                          <void property="logArguments">
                            <boolean>true</boolean>
                          </void>
                          <void property="stderrFile">
                            <object class="java.io.File">
                              <string>security_err.txt</string>
                            </object>
                          </void>
                          <void property="stdoutFile">
                            <object class="java.io.File">
                              <string>security_out.txt</string>
                            </object>
                          </void>
                          <void property="wait">
                            <boolean>true</boolean>
                          </void>
                          <void property="workingDirectory">
                            <object class="java.io.File">
                              <string>.</string>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>return Util.isLinux() &amp;&amp; Util.isAdminUser();
</condition>
                  </action>
                  <action name="Sets a key in the registry with the installationID" id="60021" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                          <void property="rollbackScript">
                            <object class="com.install4j.api.beans.ScriptProperty">
                              <void property="value">
                                <string>//Removes a key in the registry with the installationID.

String installationID = (String) context.getVariable("installationID");
String shortName = context.getCompilerVariable("sys.shortName");

if(WinRegistry.keyExists(RegistryRoot.HKEY_LOCAL_MACHINE, installationID))
{
    String newKey = "SOFTWARE\\Atlassian\\" + shortName + "\\" + installationID;
    WinRegistry.deleteKey(RegistryRoot.HKEY_LOCAL_MACHINE, newKey, false);
}</string>
                              </void>
                            </object>
                          </void>
                          <void property="script">
                            <object class="com.install4j.api.beans.ScriptProperty">
                              <void property="value">
                                <string>//Sets a key in the registry with the installationID.
String installationID = (String) context.getVariable("installationID");
String shortName = context.getCompilerVariable("sys.shortName");
if(!WinRegistry.keyExists(RegistryRoot.HKEY_LOCAL_MACHINE, installationID))
{
    String newKey = "SOFTWARE\\Atlassian\\" + shortName + "\\" + installationID;
    WinRegistry.createKey(RegistryRoot.HKEY_LOCAL_MACHINE, newKey);

    if(context.getBooleanVariable("app.install.service"))
    {
        WinRegistry.setValue(RegistryRoot.HKEY_LOCAL_MACHINE, newKey, "installedAsService", "true");
    }
    else
    {
        WinRegistry.setValue(RegistryRoot.HKEY_LOCAL_MACHINE, newKey, "installedAsService", "false");
    }
}

return true;</string>
                              </void>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>return Util.isWindows();</condition>
                  </action>
                  <action name="Add Menu Options" id="65303" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                          <void property="script">
                            <object class="com.install4j.api.beans.ScriptProperty">
                              <void property="value">
                                <string>// Set the Menu options in Windows

// String groupName = (String) context.getVariable("app.group.name");
String groupName = (String) context.getVariable("sys.programGroupName");
Boolean allUsers = context.getBooleanVariable("sys.programGroupAllUsers");
String port = context.getVariable("httpPort").toString();
String shortName = (String) context.getCompilerVariable("sys.shortName");
boolean asService = context.getBooleanVariable("app.install.service");

// Add option to open JIRA in browser
File target = context.getDestinationFile(new File("Launch JIRA in browser.url"));
File iconFile = context.getDestinationFile(new File("JIRA.ico"));
String name = context.getMessage("menu.access.jira", new Object[]{context.getCompilerVariable("sys.shortName")});

WinFileSystem.createStartMenuEntry(groupName,
    name,
    target,
    allUsers,
    iconFile);

if (asService)
{
    //Menu options should start and stop service (if installed as a service)
    target = context.getDestinationFile(new File("start_service.bat"));
    iconFile = context.getDestinationFile(new File("JIRAplay.ico"));
    name = context.getMessage("menu.start.service", new Object[]{context.getCompilerVariable("sys.shortName")});

    WinFileSystem.createStartMenuEntry(groupName,
        name + " [" + port + "]",
        target,
        allUsers,
        iconFile, null, true);

    target = context.getDestinationFile(new File("stop_service.bat"));
    iconFile = context.getDestinationFile(new File("JIRAstop.ico"));
    name = context.getMessage("menu.stop.service", new Object[]{context.getCompilerVariable("sys.shortName")});

    WinFileSystem.createStartMenuEntry(groupName,
        name + " [" + port + "]",
        target,
        allUsers,
        iconFile, null, true);

} else
{
    //menu options should start and stop JIRA app
    target = context.getDestinationFile(new File("startup_bundled_jre.bat"));
    iconFile = context.getDestinationFile(new File("JIRAplay.ico"));
    name = context.getMessage("menu.start.server", new Object[]{context.getCompilerVariable("sys.shortName")});

    WinFileSystem.createStartMenuEntry(groupName,
        name + " [" + port + "]",
        target,
        allUsers,
        iconFile);

    target = context.getDestinationFile(new File("shutdown_bundled_jre.bat"));
    iconFile = context.getDestinationFile(new File("JIRAstop.ico"));
    name = context.getMessage("menu.stop.server", new Object[]{context.getCompilerVariable("sys.shortName")});

    WinFileSystem.createStartMenuEntry(groupName,
        name + " [" + port + "]",
        target,
        allUsers,
        iconFile);
}


target = context.getDestinationFile(new File("uninstall.exe"));
iconFile = null;
name = context.getMessage("menu.uninstall");

WinFileSystem.createStartMenuEntry(groupName,
    name + " " + shortName,
    target,
    allUsers,
    iconFile);

return true;</string>
                              </void>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>return Util.isWindows();</condition>
                  </action>
                </beans>
              </group>
              <action name="" id="60020" customizedId="" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                      <void property="files">
                        <array class="java.io.File" length="1">
                          <void index="0">
                            <object class="java.io.File">
                              <string>.install4j/installation.id</string>
                            </object>
                          </void>
                        </array>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="Append installationID" id="60019" customizedId="" beanClass="com.install4j.runtime.beans.actions.text.WriteTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.text.WriteTextFileAction">
                      <void property="append">
                        <boolean>true</boolean>
                      </void>
                      <void property="file">
                        <object class="java.io.File">
                          <string>.install4j/installation.id</string>
                        </object>
                      </void>
                      <void property="text">
                        <string>${installer:installationID}</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <group name="Upgrade: transfer properties/db config and env settings" id="67714" customizedId="" beanClass="com.install4j.runtime.beans.groups.ActionGroup" enabled="true" commentSet="false" comment="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.groups.ActionGroup">
                      <void property="conditionExpression">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>return context.getBooleanVariable("sys.confirmedUpdateInstallation");</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <beans>
                  <group name="" id="69533" customizedId="" beanClass="com.install4j.runtime.beans.groups.ActionGroup" enabled="true" commentSet="false" comment="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.groups.ActionGroup">
                          <void property="conditionExpression">
                            <object class="com.install4j.api.beans.ScriptProperty">
                              <void property="value">
                                <string>context.getBooleanVariable("oldWinVersionUninstalled") </string>
                              </void>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <beans>
                      <link name="" id="69531" customizedId="" beanClass="" enabled="true" targetId="59876" mergedProjectId="" />
                      <link name="" id="69532" customizedId="" beanClass="" enabled="true" targetId="65303" mergedProjectId="" />
                      <link name="" id="69535" customizedId="" beanClass="" enabled="true" targetId="60021" mergedProjectId="" />
                    </beans>
                  </group>
                  <group name="Use saved JIRA user" id="69164" customizedId="" beanClass="com.install4j.runtime.beans.groups.ActionGroup" enabled="true" commentSet="false" comment="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.groups.ActionGroup">
                          <void property="conditionExpression">
                            <object class="com.install4j.api.beans.ScriptProperty">
                              <void property="value">
                                <string>return Util.isLinux() &amp;&amp; Util.isAdminUser();</string>
                              </void>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <beans>
                      <action name="Linux: set username in user.sh" id="69167" customizedId="" beanClass="com.install4j.runtime.beans.actions.text.ModifyTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="3" errorMessage="">
                        <serializedBean>
                          <java class="java.beans.XMLDecoder">
                            <object class="com.install4j.runtime.beans.actions.text.ModifyTextFileAction">
                              <void property="failIfNoReplacement">
                                <boolean>true</boolean>
                              </void>
                              <void property="files">
                                <array class="java.io.File" length="1">
                                  <void index="0">
                                    <object class="java.io.File">
                                      <string>bin/user.sh</string>
                                    </object>
                                  </void>
                                </array>
                              </void>
                              <void property="replaceValue">
                                <string>JIRA_USER="${installer:jiraAccountName}" # user created by installer</string>
                              </void>
                              <void property="searchValue">
                                <string>JIRA_USER="" ##</string>
                              </void>
                            </object>
                          </java>
                        </serializedBean>
                        <condition />
                      </action>
                      <action name="Configure Linux Security" id="69176" customizedId="" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="3" errorMessage="">
                        <serializedBean>
                          <java class="java.beans.XMLDecoder">
                            <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                              <void property="arguments">
                                <array class="java.lang.String" length="4">
                                  <void index="0">
                                    <string>-d</string>
                                  </void>
                                  <void index="1">
                                    <string>${installer:app.jiraHome}</string>
                                  </void>
                                  <void index="2">
                                    <string>-i</string>
                                  </void>
                                  <void index="3">
                                    <string>${installer:sys.installationDir}</string>
                                  </void>
                                </array>
                              </void>
                              <void property="executable">
                                <object class="java.io.File">
                                  <string>bin/setup_user.sh</string>
                                </object>
                              </void>
                              <void property="failOnRedirectionError">
                                <boolean>true</boolean>
                              </void>
                              <void property="logArguments">
                                <boolean>true</boolean>
                              </void>
                              <void property="stderrFile">
                                <object class="java.io.File">
                                  <string>security_err.txt</string>
                                </object>
                              </void>
                              <void property="stdoutFile">
                                <object class="java.io.File">
                                  <string>security_out.txt</string>
                                </object>
                              </void>
                              <void property="wait">
                                <boolean>true</boolean>
                              </void>
                              <void property="workingDirectory">
                                <object class="java.io.File">
                                  <string>.</string>
                                </object>
                              </void>
                            </object>
                          </java>
                        </serializedBean>
                        <condition />
                      </action>
                    </beans>
                  </group>
                  <action name="" id="67716" customizedId="" beanClass="com.install4j.runtime.beans.actions.files.CopyFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.files.CopyFileAction">
                          <void property="destinationFile">
                            <object class="java.io.File">
                              <string>bin/setenv.bat.orig</string>
                            </object>
                          </void>
                          <void property="files">
                            <array class="java.io.File" length="1">
                              <void index="0">
                                <object class="java.io.File">
                                  <string>bin/setenv.bat</string>
                                </object>
                              </void>
                            </array>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>Util.isWindows()</condition>
                  </action>
                  <action name="" id="67717" customizedId="" beanClass="com.install4j.runtime.beans.actions.files.CopyFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.files.CopyFileAction">
                          <void property="destinationFile">
                            <object class="java.io.File">
                              <string>bin/setenv.sh.orig</string>
                            </object>
                          </void>
                          <void property="files">
                            <array class="java.io.File" length="1">
                              <void index="0">
                                <object class="java.io.File">
                                  <string>bin/setenv.sh</string>
                                </object>
                              </void>
                            </array>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>!Util.isWindows()</condition>
                  </action>
                  <action name="set startup parameters" id="67715" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                          <void property="script">
                            <object class="com.install4j.api.beans.ScriptProperty">
                              <void property="value">
                                <string>import com.atlassian.inception.UpgradeHelper;
import com.atlassian.inception.JiraUpgradeHelper;

try{
    final String installDir = (String) context.getVariable("existingInstallationDir");
    UpgradeHelper helper = new JiraUpgradeHelper(installDir);
    helper.setStartupParameters((UpgradeHelper.StartupParameters)context.getVariable("startup.parameters"));
    return true;
}    
catch (Exception e)
{
    return false;
}
</string>
                              </void>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                  <action name="migrate db configuration" id="68121" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="3" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                          <void property="script">
                            <object class="com.install4j.api.beans.ScriptProperty">
                              <void property="value">
                                <string>import com.atlassian.inception.JiraDbConfigMigrator;
String installDir = (String)context.getVariable("sys.installationDir");

try {
    JiraDbConfigMigrator migrator = new JiraDbConfigMigrator(installDir);
    JiraDbConfigMigrator.DbConfigBean bean = (JiraDbConfigMigrator.DbConfigBean) context.getVariable("db.config.bean");
    return migrator.saveDbConfig(bean);
} catch (Exception e) {
    Util.log(e);
    return false;
}
</string>
                              </void>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition>return context.getBooleanVariable("app.pre44.jira");</condition>
                  </action>
                  <action name="Extract MySql connector if it exists" id="70546" customizedId="" beanClass="com.install4j.runtime.beans.actions.files.ExtractZipFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.files.ExtractZipFileAction">
                          <void property="destinationDirectory">
                            <object class="java.io.File">
                              <string>${installer:sys.installationDir}/..</string>
                            </object>
                          </void>
                          <void property="fileFilter">
                            <object class="com.install4j.api.beans.ScriptProperty">
                              <void property="value">
                                <string>return file.getName().matches("mysql-connector-java-.*\\.jar");</string>
                              </void>
                            </object>
                          </void>
                          <void property="zipFile">
                            <object class="java.io.File">
                              <string>${installer:backup.installationDir}</string>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                </beans>
              </group>
              <group name="64bit changes" id="69708" customizedId="" beanClass="com.install4j.runtime.beans.groups.ActionGroup" enabled="true" commentSet="false" comment="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.groups.ActionGroup">
                      <void property="conditionExpression">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>Boolean.parseBoolean(context.getCompilerVariable("windows.installer.64bit"))</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <beans>
                  <action name="" id="69714" customizedId="" beanClass="com.install4j.runtime.beans.actions.files.MoveFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.files.MoveFileAction">
                          <void property="destinationFile">
                            <object class="java.io.File">
                              <string>bin/tomcat7.exe.x32</string>
                            </object>
                          </void>
                          <void property="files">
                            <array class="java.io.File" length="1">
                              <void index="0">
                                <object class="java.io.File">
                                  <string>bin/tomcat7.exe</string>
                                </object>
                              </void>
                            </array>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                  <action name="" id="69715" customizedId="" beanClass="com.install4j.runtime.beans.actions.files.MoveFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.files.MoveFileAction">
                          <void property="destinationFile">
                            <object class="java.io.File">
                              <string>bin/tcnative-1.dll.x32</string>
                            </object>
                          </void>
                          <void property="files">
                            <array class="java.io.File" length="1">
                              <void index="0">
                                <object class="java.io.File">
                                  <string>bin/tcnative-1.dll</string>
                                </object>
                              </void>
                            </array>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                  <action name="" id="69711" customizedId="" beanClass="com.install4j.runtime.beans.actions.files.CopyFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.files.CopyFileAction">
                          <void property="destinationFile">
                            <object class="java.io.File">
                              <string>bin/tomcat7.exe</string>
                            </object>
                          </void>
                          <void property="files">
                            <array class="java.io.File" length="1">
                              <void index="0">
                                <object class="java.io.File">
                                  <string>bin/tomcat7.exe.x64</string>
                                </object>
                              </void>
                            </array>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                  <action name="" id="69712" customizedId="" beanClass="com.install4j.runtime.beans.actions.files.CopyFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.files.CopyFileAction">
                          <void property="destinationFile">
                            <object class="java.io.File">
                              <string>bin/tcnative-1.dll</string>
                            </object>
                          </void>
                          <void property="files">
                            <array class="java.io.File" length="1">
                              <void index="0">
                                <object class="java.io.File">
                                  <string>bin/tcnative-1.dll.x64</string>
                                </object>
                              </void>
                            </array>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                </beans>
              </group>
            </actions>
            <formComponents />
          </screen>
          <screen name="" id="59776" customizedId="" beanClass="com.install4j.runtime.beans.screens.CustomizableProgressScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="2" finishScreen="false" wizardIndexChangeType="unchanged" wizardIndexKey="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.screens.CustomizableProgressScreen">
                  <void property="cancelEnabled">
                    <boolean>false</boolean>
                  </void>
                  <void property="subTitle">
                    <string>${i18n:launching.jira.subtitle("${compiler:sys.shortName}")}</string>
                  </void>
                  <void property="title">
                    <string>${i18n:launching.jira("${compiler:sys.shortName}")}</string>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
            <validation />
            <preActivation />
            <postActivation />
            <actions>
              <action name="Create Home Directory" id="66036" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>File homeDir = new File((String)context.getVariable("app.jiraHome"));

return homeDir.mkdirs();</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="" id="66035" customizedId="" beanClass="com.install4j.runtime.beans.actions.files.AddWindowsFileRightsAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="${i18n:error.changing.file.perms}">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.AddWindowsFileRightsAction">
                      <void property="files">
                        <array class="java.io.File" length="2">
                          <void index="0">
                            <object class="java.io.File">
                              <string>.</string>
                            </object>
                          </void>
                          <void index="1">
                            <object class="java.io.File">
                              <string>${installer:app.jiraHome}</string>
                            </object>
                          </void>
                        </array>
                      </void>
                      <void property="group">
                        <object class="com.install4j.runtime.beans.actions.files.WindowsGroup" field="ORIGINAL_USER" />
                      </void>
                      <void property="read">
                        <boolean>true</boolean>
                      </void>
                      <void property="write">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>return (Util.isWindows() &amp;&amp; !context.getBooleanVariable("app.install.service"));</condition>
              </action>
              <action name="Set Progress Bar msg" id="59788" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>context.getProgressInterface().setStatusMessage(context.getMessage("launching.word") + " " + context.getCompilerVariable("sys.shortName") + " ...");
return true;</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="Start JIRA on Windows" id="59819" customizedId="" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                      <void property="executable">
                        <object class="java.io.File">
                          <string>startup_bundled_jre.bat</string>
                        </object>
                      </void>
                      <void property="executionType">
                        <object class="com.install4j.runtime.beans.actions.misc.ExecutionType" field="ORIGINAL_USER" />
                      </void>
                      <void property="workingDirectory">
                        <object class="java.io.File">
                          <string>.</string>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>return (Util.isWindows() &amp;&amp; !context.getBooleanVariable("app.install.service"));</condition>
              </action>
              <action name="Start JIRA on *nix" id="66249" customizedId="" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="${i18n:error.starting.jira(&quot;${compiler:sys.shortName}&quot;)}">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                      <void property="executable">
                        <object class="java.io.File">
                          <string>./bin/start-jira.sh</string>
                        </object>
                      </void>
                      <void property="logArguments">
                        <boolean>true</boolean>
                      </void>
                      <void property="workingDirectory">
                        <object class="java.io.File">
                          <string>./bin</string>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>return !Util.isWindows();</condition>
              </action>
              <action name="Run service" id="59878" customizedId="" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="3" errorMessage="${i18n:error.starting.service}">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                      <void property="arguments">
                        <array class="java.lang.String" length="2">
                          <void index="0">
                            <string>start</string>
                          </void>
                          <void index="1">
                            <string>${installer:installationID}</string>
                          </void>
                        </array>
                      </void>
                      <void property="executable">
                        <object class="java.io.File">
                          <string>control_service.bat</string>
                        </object>
                      </void>
                      <void property="logArguments">
                        <boolean>true</boolean>
                      </void>
                      <void property="workingDirectory">
                        <object class="java.io.File">
                          <string>.</string>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>return (Util.isWindows() &amp;&amp; context.getBooleanVariable("app.install.service"));</condition>
              </action>
              <action name="" id="59777" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.SetProgressAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.SetProgressAction">
                      <void property="progressChangeType">
                        <object class="com.install4j.runtime.beans.actions.control.ProgressChangeType" field="SET_INDETERMINATE" />
                      </void>
                      <void property="timerPeriod">
                        <int>200</int>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="Check if app is running." id="59785" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>import com.atlassian.inception.TomcatChecker;

final int shutdownPort = (int) ((Long) context.getVariable("rmiPort")).longValue();


// give the application 15 sec to start up before checking if it is running (nicer expirience)
Thread.sleep(15000);

boolean ok = TomcatChecker.isTomcatRunning(shutdownPort);
context.setVariable("app.launch.error", !ok);
return ok;</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
              <group name="Tidy up if originally normal user install" id="69405" customizedId="" beanClass="com.install4j.runtime.beans.groups.ActionGroup" enabled="true" commentSet="false" comment="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.groups.ActionGroup">
                      <void property="conditionExpression">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>// Tidy up non-windows environment if orginal install was done by normal user and it is an update
return !Util.isWindows() &amp;&amp; context.getBooleanVariable("isNormalUserInstall") &amp;&amp;  context.getBooleanVariable("sys.confirmedUpdateInstallation");</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <beans>
                  <action name="chown entire installation directory" id="69406" customizedId="" beanClass="com.install4j.runtime.beans.actions.files.SetOwnerAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.files.SetOwnerAction">
                          <void property="files">
                            <array class="java.io.File" length="1">
                              <void index="0">
                                <object class="java.io.File">
                                  <string>.</string>
                                </object>
                              </void>
                            </array>
                          </void>
                          <void property="owner">
                            <string>${installer:jiraAccountName}</string>
                          </void>
                          <void property="recursive">
                            <boolean>true</boolean>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                  <action name="Reset user.sh to blank" id="69192" customizedId="" beanClass="com.install4j.runtime.beans.actions.text.RegexTextFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.actions.text.RegexTextFileAction">
                          <void property="escapeForPropertyFile">
                            <boolean>true</boolean>
                          </void>
                          <void property="failIfNoReplacement">
                            <boolean>true</boolean>
                          </void>
                          <void property="files">
                            <array class="java.io.File" length="1">
                              <void index="0">
                                <object class="java.io.File">
                                  <string>bin/user.sh</string>
                                </object>
                              </void>
                            </array>
                          </void>
                          <void property="regex">
                            <string>(?m)JIRA_USER.*?$</string>
                          </void>
                          <void property="replacement">
                            <string>JIRA_USER="" ##</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <condition />
                  </action>
                </beans>
              </group>
            </actions>
            <formComponents />
          </screen>
          <screen name="Custom Finish Screen" id="70143" customizedId="" beanClass="com.install4j.runtime.beans.screens.BannerFormScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="3" finishScreen="true" wizardIndexChangeType="unchanged" wizardIndexKey="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.screens.BannerFormScreen">
                  <void property="bannerImageFile">
                    <object class="com.install4j.api.beans.ExternalFile">
                      <string>./images/jira_logo_large.png</string>
                    </object>
                  </void>
                  <void property="scrollable">
                    <boolean>false</boolean>
                  </void>
                  <void property="title">
                    <string>${i18n:FinishedHeadingLabel(${compiler:sys.fullName})}</string>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
            <validation />
            <preActivation />
            <postActivation />
            <actions>
              <action name="" id="59784" customizedId="" beanClass="com.install4j.runtime.beans.actions.finish.ShowURLAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="3" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.finish.ShowURLAction">
                      <void property="urlSpec">
                        <string>http://localhost:${installer:httpPort}/</string>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>Util.isWindows() &amp;&amp; context.getBooleanVariable("executeLauncherAction") &amp;&amp; (!context.isUnattended())</condition>
              </action>
              <action name="Write Modz Registry" id="68582" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="${i18n:error.failed.modz.register}">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>import com.atlassian.inception.modz.ModificationHelper;

String REG_FILE_NAME = "install.reg";

String installDir = (String)context.getVariable("sys.installationDir");

ModificationHelper modzHelper = ModificationHelper.createJiraHelper(installDir);
modzHelper.writeInstallerRegistry(installDir + "/" + REG_FILE_NAME, installDir);

context.registerUninstallFile(new File(installDir, REG_FILE_NAME));

return true;                            </string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
            </actions>
            <formComponents>
              <group name="" id="70146" customizedId="" beanClass="com.install4j.runtime.beans.groups.VerticalFormComponentGroup" enabled="true" commentSet="false" comment="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.groups.VerticalFormComponentGroup" />
                  </java>
                </serializedBean>
                <beans>
                  <formComponent name="" id="70147" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.MultilineLabelComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="5" insetRight="" resetInitOnPrevious="false">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.formcomponents.MultilineLabelComponent">
                          <void property="labelText">
                            <string>${i18n:finish.ready.message(${compiler:sys.fullName})}</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <initScript />
                    <visibilityScript />
                  </formComponent>
                  <formComponent name="tomcat warning" id="70148" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.MultilineHtmlLabelComponent" enabled="true" commentSet="false" comment="" insetTop="5" insetLeft="" insetBottom="5" insetRight="" resetInitOnPrevious="true">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.formcomponents.MultilineHtmlLabelComponent">
                          <void property="labelHtml">
                            <string>${i18n:finish.launch.tomcat(${compiler:sys.shortName})}</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <initScript />
                    <visibilityScript>return (Util.isWindows() &amp;&amp; !context.getBooleanVariable("app.install.service"));</visibilityScript>
                  </formComponent>

                  // removed pre 5.0 support
                  <formComponent name="Windows. Post-install4J. server.xml changed" id="70352" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.MultilineHtmlLabelComponent" enabled="true" commentSet="false" comment="" insetTop="5" insetLeft="" insetBottom="5" insetRight="" resetInitOnPrevious="true">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.formcomponents.MultilineHtmlLabelComponent">
                          <void property="labelHtml">
                            <string>${i18n:finish.serverxml.definite.change.windows(${compiler:docs.version}, "${compiler:sys.shortName}")}</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <initScript />
                    <visibilityScript>return context.getBooleanVariable("serverXml.modz") &amp;&amp; context.getBooleanVariable("sys.confirmedUpdateInstallation") &amp;&amp; Util.isWindows();</visibilityScript>
                  </formComponent>
                  <formComponent name="Windows. Post-install4J. Some change" id="70353" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.MultilineHtmlLabelComponent" enabled="true" commentSet="false" comment="" insetTop="5" insetLeft="" insetBottom="5" insetRight="" resetInitOnPrevious="true">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.formcomponents.MultilineHtmlLabelComponent">
                          <void property="labelHtml">
                            <string>${i18n:finish.serverxml.other.change.windows(${compiler:docs.version}, "${compiler:sys.shortName}")}</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <initScript />
                    <visibilityScript>// Post install4J - some change has occurred (no server.xml)
boolean nonServerXmlModz = context.getBooleanVariable("anyModz") &amp;&amp; !context.getBooleanVariable("serverXml.modz");
return nonServerXmlModz &amp;&amp; !context.getBooleanVariable("app.pre44.jira") &amp;&amp; context.getBooleanVariable("sys.confirmedUpdateInstallation") &amp;&amp; Util.isWindows();</visibilityScript>
                  </formComponent>

                  // removed pre 5.0 support
                  <formComponent name="Post-install4J. server.xml changed" id="70355" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.MultilineHtmlLabelComponent" enabled="true" commentSet="false" comment="" insetTop="5" insetLeft="" insetBottom="5" insetRight="" resetInitOnPrevious="true">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.formcomponents.MultilineHtmlLabelComponent">
                          <void property="labelHtml">
                            <string>${i18n:finish.serverxml.definite.change(${compiler:docs.version}, "${compiler:sys.shortName}")}</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <initScript />
                    <visibilityScript>return context.getBooleanVariable("serverXml.modz") &amp;&amp; context.getBooleanVariable("sys.confirmedUpdateInstallation") &amp;&amp; !Util.isWindows();</visibilityScript>
                  </formComponent>
                  <formComponent name="Post-install4J. Some change" id="70356" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.MultilineHtmlLabelComponent" enabled="true" commentSet="false" comment="" insetTop="5" insetLeft="" insetBottom="5" insetRight="" resetInitOnPrevious="true">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.formcomponents.MultilineHtmlLabelComponent">
                          <void property="labelHtml">
                            <string>${i18n:finish.serverxml.other.change(${compiler:docs.version}, "${compiler:sys.shortName}")}</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <initScript />
                    <visibilityScript>// Post install4J - some change has occurred (no server.xml)
boolean nonServerXmlModz = context.getBooleanVariable("anyModz") &amp;&amp; !context.getBooleanVariable("serverXml.modz");
return nonServerXmlModz &amp;&amp; !context.getBooleanVariable("app.pre44.jira") &amp;&amp; context.getBooleanVariable("sys.confirmedUpdateInstallation") &amp;&amp; !Util.isWindows();</visibilityScript>
                  </formComponent>
                  <formComponent name="URL Location Label (non-windows)" id="70151" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.MultilineLabelComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.formcomponents.MultilineLabelComponent">
                          <void property="labelText">
                            <string>${compiler:sys.fullName} can be accessed at http://localhost:${installer:httpPort}</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <initScript />
                    <visibilityScript>return !Util.isWindows();</visibilityScript>
                  </formComponent>
                  <formComponent name="Execute launcher" id="70152" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.CheckboxComponent" enabled="true" commentSet="false" comment="" insetTop="10" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.formcomponents.CheckboxComponent">
                          <void property="checkboxText">
                            <string>${i18n:finish.launch.browser("${compiler:sys.fullName}")}</string>
                          </void>
                          <void property="initiallySelected">
                            <boolean>true</boolean>
                          </void>
                          <void property="variableName">
                            <string>executeLauncherAction</string>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <initScript />
                    <visibilityScript>return Util.isWindows();</visibilityScript>
                  </formComponent>
                  <formComponent name="" id="70153" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.SpringComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.formcomponents.SpringComponent">
                          <void property="axisType">
                            <object class="com.install4j.runtime.beans.formcomponents.AxisType" field="VERTICAL" />
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <initScript />
                    <visibilityScript />
                  </formComponent>
                  <group name="" id="70154" customizedId="" beanClass="com.install4j.runtime.beans.groups.HorizontalFormComponentGroup" enabled="true" commentSet="false" comment="">
                    <serializedBean>
                      <java class="java.beans.XMLDecoder">
                        <object class="com.install4j.runtime.beans.groups.HorizontalFormComponentGroup">
                          <void property="insets">
                            <object class="java.awt.Insets">
                              <int>10</int>
                              <int>0</int>
                              <int>0</int>
                              <int>0</int>
                            </object>
                          </void>
                          <void property="visibilityScript">
                            <object class="com.install4j.api.beans.ScriptProperty">
                              <void property="value">
                                <string>return context.getBooleanVariable("sys.confirmedUpdateInstallation");</string>
                              </void>
                            </object>
                          </void>
                        </object>
                      </java>
                    </serializedBean>
                    <beans>
                      <formComponent name="" id="70155" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.LabelComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                        <serializedBean>
                          <java class="java.beans.XMLDecoder">
                            <object class="com.install4j.runtime.beans.formcomponents.LabelComponent">
                              <void property="labelIconFile">
                                <object class="com.install4j.api.beans.ExternalFile">
                                  <string>./images/warning16x16.png</string>
                                </object>
                              </void>
                            </object>
                          </java>
                        </serializedBean>
                        <initScript />
                        <visibilityScript />
                      </formComponent>
                      <formComponent name="" id="70156" customizedId="" beanClass="com.install4j.runtime.beans.formcomponents.MultilineLabelComponent" enabled="true" commentSet="false" comment="" insetTop="" insetLeft="" insetBottom="" insetRight="" resetInitOnPrevious="false">
                        <serializedBean>
                          <java class="java.beans.XMLDecoder">
                            <object class="com.install4j.runtime.beans.formcomponents.MultilineLabelComponent">
                              <void property="labelText">
                                <string>${i18n:launch.wait.warning}</string>
                              </void>
                            </object>
                          </java>
                        </serializedBean>
                        <initScript />
                        <visibilityScript />
                      </formComponent>
                    </beans>
                  </group>
                </beans>
              </group>
            </formComponents>
          </screen>
        </screens>
      </application>
      <application name="" id="uninstaller" customizedId="" beanClass="com.install4j.runtime.beans.applications.UninstallerApplication" enabled="true" commentSet="false" comment="" fileset="" customIcnsFile="" customIcoFile="./images/JIRA.ico" automaticLauncherIntegration="false" launchMode="startupFirstWindow" launchInNewProcess="false" launchSchedule="updateSchedule" allLaunchers="true">
        <serializedBean>
          <java class="java.beans.XMLDecoder">
            <object class="com.install4j.runtime.beans.applications.UninstallerApplication">
              <void property="customIconImageFiles">
                <void method="add">
                  <object class="com.install4j.api.beans.ExternalFile">
                    <string>./images/Jira_16.png</string>
                  </object>
                </void>
                <void method="add">
                  <object class="com.install4j.api.beans.ExternalFile">
                    <string>./images/Jira_32.png</string>
                  </object>
                </void>
              </void>
              <void property="frameSizeClientArea">
                <boolean>false</boolean>
              </void>
              <void property="useCustomIcon">
                <boolean>true</boolean>
              </void>
              <void property="vmParameters">
                <string>-Dinstall4j.executionMode=${compiler:install.execution.mode} </string>
              </void>
              <void property="watermark">
                <boolean>false</boolean>
              </void>
            </object>
          </java>
        </serializedBean>
        <launcherIds />
        <variables />
        <startup>
          <screen name="" id="16" customizedId="" beanClass="com.install4j.runtime.beans.screens.StartupScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="2" finishScreen="false" wizardIndexChangeType="unchanged" wizardIndexKey="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.screens.StartupScreen" />
              </java>
            </serializedBean>
            <condition />
            <validation />
            <preActivation />
            <postActivation />
            <actions>
              <link name="" id="65938" customizedId="" beanClass="" enabled="true" targetId="65936" mergedProjectId="" />
              <action name="" id="68854" customizedId="" beanClass="com.install4j.runtime.beans.actions.misc.LoadResponseFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.misc.LoadResponseFileAction" />
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="" id="59775" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="2" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>if(Util.isAdminUser())
{
    return true;
}
else
{
    int selection = Util.showOptionDialog(context.getMessage("error.no.admin.rights.uninstall"), new String[] {context.getMessage("message.button.yes"), context.getMessage("message.button.no")}, javax.swing.JOptionPane.WARNING_MESSAGE);
    if(selection==0)
    {
        return true;
    }

    return false;
}</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
            </actions>
            <formComponents />
          </screen>
        </startup>
        <screens>
          <screen name="" id="10" customizedId="" beanClass="com.install4j.runtime.beans.screens.UninstallWelcomeScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="2" finishScreen="false" wizardIndexChangeType="unchanged" wizardIndexKey="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.screens.UninstallWelcomeScreen">
                  <void property="bannerImageFile">
                    <object class="com.install4j.api.beans.ExternalFile">
                      <string>./images/jira_logo_large.png</string>
                    </object>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
            <validation />
            <preActivation />
            <postActivation />
            <actions>
              <action name="Set uninstall paramters" id="68020" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>import com.atlassian.inception.UpgradeHelper;
import com.atlassian.inception.JiraUpgradeHelper;

final String installDir = context.getInstallationDirectory().getPath();

try
{
    UpgradeHelper helper = new JiraUpgradeHelper(installDir);
    context.setVariable("httpPort", helper.getHttpPort());
    context.setVariable("rmiPort", helper.getRmiPort());
}
catch (Throwable t)
{
    return false;
}

return true; // FIXME catch exceptions and return false if cought</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
            </actions>
            <formComponents />
          </screen>
          <screen name="" id="11" customizedId="" beanClass="com.install4j.runtime.beans.screens.UninstallationScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="2" finishScreen="false" wizardIndexChangeType="unchanged" wizardIndexKey="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.screens.UninstallationScreen" />
              </java>
            </serializedBean>
            <condition />
            <validation />
            <preActivation />
            <postActivation />
            <actions>
              <action name="Shutdown JIRA (Linux)" id="67428" customizedId="" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                      <void property="executable">
                        <object class="java.io.File">
                          <string>bin/stop-jira.sh</string>
                        </object>
                      </void>
                      <void property="wait">
                        <boolean>true</boolean>
                      </void>
                      <void property="workingDirectory">
                        <object class="java.io.File">
                          <string>.</string>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>return Util.isLinux();</condition>
              </action>
              <action name="Remove Service" id="66854" customizedId="" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                      <void property="arguments">
                        <array class="java.lang.String" length="1">
                          <void index="0">
                            <string>remove</string>
                          </void>
                        </array>
                      </void>
                      <void property="executable">
                        <object class="java.io.File">
                          <string>bin/service.bat</string>
                        </object>
                      </void>
                      <void property="wait">
                        <boolean>true</boolean>
                      </void>
                      <void property="workingDirectory">
                        <object class="java.io.File">
                          <string>.</string>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>if (Util.isWindows())
{
    BufferedReader in = null;
    boolean result = false;
    String shortName = context.getCompilerVariable("sys.shortName");
    try
    {
        File installationIDFile = context.getDestinationFile("/.install4j/installation.id");
        in = new BufferedReader(new FileReader(installationIDFile));
        String installationID = in.readLine();
        if(installationID!= null &amp;&amp; installationID.trim().length() &gt; 0)
        {
            //check if we need to delete the service...
            String regKey = "SOFTWARE\\Atlassian\\" + shortName + "\\" + installationID;
            if(WinRegistry.keyExists(RegistryRoot.HKEY_LOCAL_MACHINE, regKey))
            {
                boolean installedAsService = Boolean.parseBoolean((String) WinRegistry.getValue(RegistryRoot.HKEY_LOCAL_MACHINE, regKey, "installedAsService"));
                if(installedAsService)
                {
                    result = true;
                }

                //Now lets delete the key.
                WinRegistry.deleteKey(RegistryRoot.HKEY_LOCAL_MACHINE, regKey, false);
            }
        }
        in.close();
        installationIDFile.delete();
    }
    catch (Throwable t)
    {
        result = false;
    }
    return result;
}
return false;</condition>
              </action>
              <action name="Remove linux service" id="59820" customizedId="" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                      <void property="arguments">
                        <array class="java.lang.String" length="1">
                          <void index="0">
                            <string>-u</string>
                          </void>
                        </array>
                      </void>
                      <void property="executable">
                        <object class="java.io.File">
                          <string>bin/install_linux_service.sh</string>
                        </object>
                      </void>
                      <void property="wait">
                        <boolean>true</boolean>
                      </void>
                      <void property="workingDirectory">
                        <object class="java.io.File">
                          <string>.</string>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>return Util.isLinux() &amp;&amp; Util.isAdminUser();</condition>
              </action>
              <action name="Shutdown JIRA (Windows)" id="59880" customizedId="" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                      <void property="executable">
                        <object class="java.io.File">
                          <string>shutdown_bundled_jre.bat</string>
                        </object>
                      </void>
                      <void property="wait">
                        <boolean>true</boolean>
                      </void>
                      <void property="workingDirectory">
                        <object class="java.io.File">
                          <string>.</string>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>return Util.isWindows();</condition>
              </action>
              <link name="" id="68018" customizedId="" beanClass="" enabled="true" targetId="68017" mergedProjectId="" />
              <action name="Remove Linux User" id="67047" customizedId="" beanClass="com.install4j.runtime.beans.actions.misc.RunExecutableAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="${i18n:error.deleting.jira.user(&quot;${compiler:sys.shortName}&quot;)}">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.misc.RunExecutableAction">
                      <void property="arguments">
                        <array class="java.lang.String" length="1">
                          <void index="0">
                            <string>-u</string>
                          </void>
                        </array>
                      </void>
                      <void property="executable">
                        <object class="java.io.File">
                          <string>bin/setup_user.sh</string>
                        </object>
                      </void>
                      <void property="failOnRedirectionError">
                        <boolean>true</boolean>
                      </void>
                      <void property="logArguments">
                        <boolean>true</boolean>
                      </void>
                      <void property="wait">
                        <boolean>true</boolean>
                      </void>
                      <void property="workingDirectory">
                        <object class="java.io.File">
                          <string>.</string>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>return Util.isLinux() &amp;&amp; Util.isAdminUser();</condition>
              </action>
              <action name="" id="12" customizedId="" beanClass="com.install4j.runtime.beans.actions.UninstallFilesAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.UninstallFilesAction" />
                  </java>
                </serializedBean>
                <condition />
              </action>
              <action name="Remove Start Menu" id="68900" customizedId="" beanClass="com.install4j.runtime.beans.actions.control.RunScriptAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.control.RunScriptAction">
                      <void property="script">
                        <object class="com.install4j.api.beans.ScriptProperty">
                          <void property="value">
                            <string>boolean isAllUsers = context.getBooleanVariable("sys.programGroupAllUsers");

// Append path so we are at JIRA's startmenu item
String startMenuName = (String)context.getVariable("sys.programGroupName");

String  startMenuBase = WinFileSystem.getSpecialFolder(SpecialFolder.STARTMENU, isAllUsers).getAbsolutePath() + "\\Programs\\";
File startMenuDir = new File(startMenuBase + startMenuName);

// Seems like for Win7 start menus can be in programDataDirectory...
if (!startMenuDir.exists()) {
    startMenuBase = WinFileSystem.getProgramDataDirectory().getAbsolutePath() + "\\Microsoft\\Windows\\Start Menu";
    startMenuDir = new File(startMenuBase + startMenuName);   
}


org.apache.commons.io.FileUtils.deleteDirectory(startMenuDir);

return true;</string>
                          </void>
                        </object>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition>return Util.isWindows();</condition>
              </action>
              <action name="" id="65355" customizedId="" beanClass="com.install4j.runtime.beans.actions.files.DeleteFileAction" enabled="true" commentSet="false" comment="" rollbackBarrier="false" multiExec="false" failureStrategy="1" errorMessage="">
                <serializedBean>
                  <java class="java.beans.XMLDecoder">
                    <object class="com.install4j.runtime.beans.actions.files.DeleteFileAction">
                      <void property="files">
                        <array class="java.io.File" length="4">
                          <void index="0">
                            <object class="java.io.File">
                              <string>work</string>
                            </object>
                          </void>
                          <void index="1">
                            <object class="java.io.File">
                              <string>jre</string>
                            </object>
                          </void>
                          <void index="2">
                            <object class="java.io.File">
                              <string>temp</string>
                            </object>
                          </void>
                          <void index="3">
                            <object class="java.io.File">
                              <string>.install4j</string>
                            </object>
                          </void>
                        </array>
                      </void>
                      <void property="recursive">
                        <boolean>true</boolean>
                      </void>
                    </object>
                  </java>
                </serializedBean>
                <condition />
              </action>
            </actions>
            <formComponents />
          </screen>
          <screen name="" id="14" customizedId="" beanClass="com.install4j.runtime.beans.screens.UninstallFailureScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="2" finishScreen="true" wizardIndexChangeType="unchanged" wizardIndexKey="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.screens.UninstallFailureScreen" />
              </java>
            </serializedBean>
            <condition />
            <validation />
            <preActivation />
            <postActivation />
            <actions />
            <formComponents />
          </screen>
          <screen name="" id="13" customizedId="" beanClass="com.install4j.runtime.beans.screens.UninstallSuccessScreen" enabled="true" commentSet="false" comment="" rollbackBarrier="false" backButton="2" finishScreen="true" wizardIndexChangeType="unchanged" wizardIndexKey="">
            <serializedBean>
              <java class="java.beans.XMLDecoder">
                <object class="com.install4j.runtime.beans.screens.UninstallSuccessScreen">
                  <void property="bannerImageFile">
                    <object class="com.install4j.api.beans.ExternalFile">
                      <string>./images/jira_logo_large.png</string>
                    </object>
                  </void>
                </object>
              </java>
            </serializedBean>
            <condition />
            <validation />
            <preActivation />
            <postActivation />
            <actions />
            <formComponents />
          </screen>
        </screens>
      </application>
    </applications>
  </installerGui>
  <mediaSets>
    <windows name="Windows" id="22" customizedId="" mediaFileName="${compiler:dist.name}-${compiler:app.version}-x32" installDir="${compiler:sys.shortName}" overridePrincipalLanguage="false" jreBitType="32" runPostProcessor="true" postProcessor="mono ${compiler:install4j.home}/resource/signcode.exe -spc ${compiler:keystore.home}/atlassian.spc  -v ${compiler:keystore.home}/private.pvk -vp ${compiler:keystore.password} -t ${compiler:timestamp.server} $EXECUTABLE" failOnPostProcessorError="true" useLegacyMediaFileIds="false" legacyMediaFileIds="" includedJRE="jre1.8.0_11-windows-x86" manualJREEntry="false" bundleType="1" jreURL="" jreFtpURL="" jreShared="false" directDownload="false" installOnlyIfNecessary="false" customInstallBaseDir="" contentFilesType="1" downloadURL="" verifyIntegrity="true">
      <excludedLaunchers />
      <excludedBeans />
      <overriddenPrincipalLanguage id="en" customLocalizationFile="" />
      <exclude />
      <variables />
      <autoUpdate useMinUpdatableVersion="false" minUpdatableVersion="" useMaxUpdatableVersion="false" maxUpdatableVersion="">
        <commentFiles />
        <customAttributes />
      </autoUpdate>
      <excludedComponents />
      <includedDownloadableComponents />
    </windows>
    <unixInstaller name="Unix Installer" id="66154" customizedId="" mediaFileName="${compiler:dist.name}-${compiler:app.version}-x32" installDir="${compiler:sys.shortName}" overridePrincipalLanguage="false" jreBitType="all" runPostProcessor="false" postProcessor="" failOnPostProcessorError="false" useLegacyMediaFileIds="false" legacyMediaFileIds="" includedJRE="jre1.8.0_11-linux-x86" manualJREEntry="false" bundleType="1" jreURL="" jreFtpURL="" jreShared="false" directDownload="false" installOnlyIfNecessary="false" customInstallBaseDir="" contentFilesType="1" downloadURL="">
      <excludedLaunchers />
      <excludedBeans />
      <overriddenPrincipalLanguage id="en" customLocalizationFile="" />
      <exclude>
        <entry location="shutdown_bundled_jre.bat" fileType="regular" />
        <entry location="JIRAplay.ico" fileType="regular" />
        <entry location="start_service.bat" fileType="regular" />
        <entry location="JIRAstop.ico" fileType="regular" />
        <entry location="control_service.bat" fileType="regular" />
        <entry location="startup_bundled_jre.bat" fileType="regular" />
        <entry location="Launch JIRA in browser.url" fileType="regular" />
        <entry location="stop_service.bat" fileType="regular" />
        <entry location="JIRA.ico" fileType="regular" />
      </exclude>
      <variables>
        <variable name="install.execution.mode" value="console" description="" category="" />
      </variables>
      <autoUpdate useMinUpdatableVersion="false" minUpdatableVersion="" useMaxUpdatableVersion="false" maxUpdatableVersion="">
        <commentFiles />
        <customAttributes />
      </autoUpdate>
      <excludedComponents />
      <includedDownloadableComponents />
      <installerScript mode="1" file="">
        <content />
      </installerScript>
    </unixInstaller>
    <unixInstaller name="Linux 64bit Installer" id="68855" customizedId="" mediaFileName="${compiler:dist.name}-${compiler:app.version}-x64" installDir="${compiler:sys.shortName}" overridePrincipalLanguage="false" jreBitType="all" runPostProcessor="false" postProcessor="" failOnPostProcessorError="false" useLegacyMediaFileIds="false" legacyMediaFileIds="" includedJRE="jre1.8.0_11-linux-x64" manualJREEntry="false" bundleType="1" jreURL="" jreFtpURL="" jreShared="false" directDownload="false" installOnlyIfNecessary="false" customInstallBaseDir="" contentFilesType="1" downloadURL="">
      <excludedLaunchers />
      <excludedBeans />
      <overriddenPrincipalLanguage id="en" customLocalizationFile="" />
      <exclude>
        <entry location="shutdown_bundled_jre.bat" fileType="regular" />
        <entry location="JIRAplay.ico" fileType="regular" />
        <entry location="JIRAstop.ico" fileType="regular" />
        <entry location="JIRA.ico" fileType="regular" />
        <entry location="control_service.bat" fileType="regular" />
        <entry location="stop_service.bat" fileType="regular" />
        <entry location="start_service.bat" fileType="regular" />
        <entry location="startup_bundled_jre.bat" fileType="regular" />
        <entry location="Launch JIRA in browser.url" fileType="regular" />
      </exclude>
      <variables>
        <variable name="install.execution.mode" value="console" description="" category="" />
      </variables>
      <autoUpdate useMinUpdatableVersion="false" minUpdatableVersion="" useMaxUpdatableVersion="false" maxUpdatableVersion="">
        <commentFiles />
        <customAttributes />
      </autoUpdate>
      <excludedComponents />
      <includedDownloadableComponents />
      <installerScript mode="1" file="">
        <content />
      </installerScript>
    </unixInstaller>
    <windows name="Windows 64 bit" id="69705" customizedId="" mediaFileName="${compiler:dist.name}-${compiler:app.version}-x64" installDir="${compiler:sys.shortName}" overridePrincipalLanguage="false" jreBitType="64" runPostProcessor="true" postProcessor="mono ${compiler:install4j.home}/resource/signcode.exe -spc ${compiler:keystore.home}/atlassian.spc  -v ${compiler:keystore.home}/private.pvk -vp ${compiler:keystore.password} -t ${compiler:timestamp.server} $EXECUTABLE" failOnPostProcessorError="true" useLegacyMediaFileIds="false" legacyMediaFileIds="" includedJRE="jre1.8.0_11-windows-x64" manualJREEntry="false" bundleType="1" jreURL="" jreFtpURL="" jreShared="false" directDownload="false" installOnlyIfNecessary="false" customInstallBaseDir="" contentFilesType="1" downloadURL="" verifyIntegrity="true">
      <excludedLaunchers />
      <excludedBeans />
      <overriddenPrincipalLanguage id="en" customLocalizationFile="" />
      <exclude />
      <variables>
        <variable name="windows.installer.64bit" value="true" description="" category="" />
      </variables>
      <autoUpdate useMinUpdatableVersion="false" minUpdatableVersion="" useMaxUpdatableVersion="false" maxUpdatableVersion="">
        <commentFiles />
        <customAttributes />
      </autoUpdate>
      <excludedComponents />
      <includedDownloadableComponents />
    </windows>
  </mediaSets>
  <buildIds buildAll="true">
    <mediaSet refId="66154" />
  </buildIds>
  <buildOptions verbose="true" faster="false" debug="false" />
</install4j>

